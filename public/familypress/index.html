<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>FamilyPress - å®¶æ—SNS & è‡ªå‹•æ–°èç”Ÿæˆ</title>
<meta name="description" content="å®¶æ—ã®æ—¥å¸¸å…±æœ‰ãŒãã®ã¾ã¾æ–°èã«ãªã‚‹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“°</text></svg>">
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<style>
*{box-sizing:border-box;margin:0;padding:0}
html,body,#root{height:100%;width:100%}
body{background:#f7f3eb;overflow-x:hidden}
input,textarea,button,select{font-family:inherit}
::-webkit-scrollbar{width:0;height:0}
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const {useState,useEffect,useCallback,useMemo}=React;

const C={bg:"#f7f3eb",card:"#fff",bdr:"#e5dfd2",tx:"#2a2620",mid:"#6b645c",lt:"#9f9788",ac:"#bf4f38",gn:"#3c8260",bl:"#3a6da3",gd:"#a6802b",wm:"#ede7dc",dk:"#2a2620"};
const PT={photo:{i:"ğŸ“¸",l:"ãƒ•ã‚©ãƒˆ",c:C.ac},blog:{i:"ğŸ“",l:"ãƒ–ãƒ­ã‚°",c:C.bl},growth:{i:"ğŸ“Š",l:"æˆé•·",c:C.gn},quick:{i:"ğŸ“Œ",l:"ã²ã¨ã“ã¨",c:C.gd}};
const RCT=["â¤ï¸","ğŸ˜†","ğŸ¥²","ğŸ‰","ğŸ‘"];
const SK="fp-v5";
const uid=()=>Date.now().toString(36)+Math.random().toString(36).slice(2,6);
const fD=(s)=>{const d=new Date(s);return `${d.getMonth()+1}/${d.getDate()}ï¼ˆ${"æ—¥æœˆç«æ°´æœ¨é‡‘åœŸ"[d.getDay()]}ï¼‰`;};
const fT=(s)=>{const d=new Date(s);return `${d.getHours()}:${String(d.getMinutes()).padStart(2,"0")}`;};

const INIT={
  family:"ã¨ã‚‚ãˆãƒ•ã‚¡ãƒŸãƒªãƒ¼",user:"papa",
  members:[{id:"papa",name:"ãƒ‘ãƒ‘",em:"ğŸ‘¨",role:"admin"},{id:"mama",name:"ãƒãƒ",em:"ğŸ‘©",role:"admin"},{id:"jiiji",name:"ã˜ã„ã˜",em:"ğŸ‘´",role:"viewer"},{id:"baaba",name:"ã°ã‚ã°",em:"ğŸ‘µ",role:"viewer"}],
  posts:[
    {id:"s1",type:"photo",author:"papa",at:"2026-02-15T15:20:00Z",text:"ã¨ã‚‚ãˆã€ã¯ã˜ã‚ã¦ã®ä¸€æ­©ï¼ã‚½ãƒ•ã‚¡ã‹ã‚‰æ‰‹ã‚’é›¢ã—ã¦3æ­©æ­©ã„ãŸã€‚å¤•æ–¹ã«ã¯5æ­©ã¾ã§è¨˜éŒ²æ›´æ–°ã€‚æ³£ã„ãŸã€‚",title:"",photos:["ğŸ‘£","ğŸ‰","ğŸ¥¹"],tags:["ã¯ã˜ã‚ã¦","ã‚ã‚“ã‚ˆ"],rx:{"â¤ï¸":4,"ğŸ‰":3},cm:[{id:"c1",a:"mama",t:"å‹•ç”»ã«æ’®ã‚Œã¦ã‚ˆã‹ã£ãŸï¼"},{id:"c2",a:"jiiji",t:"ã™ã”ã„ãï¼ï¼"},{id:"c3",a:"baaba",t:"å·æ³£ã—ã¾ã—ãŸ"}]},
    {id:"s2",type:"growth",author:"papa",at:"2026-02-17T20:00:00Z",text:"",title:"",photos:[],tags:[],gr:{h:72.5,w:8.6,te:4,sl:10.5},ms:["4æœ¬ç›®ã®æ­¯ãŒç”ŸãˆãŸï¼"],rx:{"ğŸ‰":2},cm:[]},
    {id:"s3",type:"blog",author:"papa",at:"2026-02-17T22:30:00Z",title:"ã€Œã¯ã˜ã‚ã¦ã€ãŒæ•™ãˆã¦ãã‚Œã‚‹ã“ã¨",text:"ã¨ã‚‚ãˆãŒä¸€æ­©ã‚’è¸ã¿å‡ºã—ãŸç¬é–“ã€ä¸–ç•ŒãŒå¤‰ã‚ã£ãŸæ°—ãŒã—ãŸã€‚å¤§äººã«ã¨ã£ã¦ã¯å½“ãŸã‚Šå‰ã®ã€Œæ­©ãã€ãŒã“ã‚“ãªã«æ„Ÿå‹•çš„ã¨ã¯ã€‚\n\næ¯æ—¥ã®è¨˜éŒ²ã¯é¢å€’ãªæ—¥ã‚‚ã‚ã‚‹ã€‚ã§ã‚‚ã€Œã¡ã‚ƒã‚“ã¨æ®‹ã—ãŸã„ã€ã€‚ã¨ã‚‚ãˆãŒå¤§ãããªã£ãŸæ™‚ã€ä¸€ç·’ã«èª­ã¿è¿”ã—ãŸã„ã€‚\n\næ¥é€±ã¯ã„ã‚ˆã„ã‚ˆä¸€æ­³ã®èª•ç”Ÿæ—¥ã€‚ãã£ã¨æ–°ã—ã„ã€Œã¯ã˜ã‚ã¦ã€ãŒå¾…ã£ã¦ã„ã‚‹ã€‚",photos:["ğŸ‘¶"],tags:["è‚²å…","ã‚³ãƒ©ãƒ "],rx:{"â¤ï¸":4,"ğŸ¥²":2},cm:[{id:"c4",a:"mama",t:"æ³£ã„ãŸğŸ˜­"}]},
    {id:"s4",type:"quick",author:"mama",at:"2026-02-18T12:00:00Z",text:"ã¨ã‚‚ãˆèªéŒ²ğŸ“ã€Œã°ãƒ¼ã¶ï¼ã€ï¼ˆã°ã‚ã°ã¨è¨€ã„ãŸã„ã‚‰ã—ã„ï¼‰",title:"",photos:[],tags:[],rx:{"ğŸ˜‚":3},cm:[{id:"c5",a:"baaba",t:"çµ¶å¯¾ã‚ãŸã—ã®ã“ã¨å‘¼ã‚“ã§ã‚‹ï¼ï¼"}]},
    {id:"s5",type:"photo",author:"mama",at:"2026-02-18T15:30:00Z",text:"ç ‚å ´ãƒ‡ãƒ“ãƒ¥ãƒ¼ï¼ã‚¹ã‚³ãƒƒãƒ—æŒã£ãŸã‚‰å¤¢ä¸­ã§40åˆ†éŠã‚“ã§ãŸğŸ˜†",title:"",photos:["ğŸ–ï¸","â›±ï¸","ğŸª£"],tags:["ç ‚å ´","ã¯ã˜ã‚ã¦"],rx:{"â¤ï¸":3,"ğŸ˜†":1},cm:[{id:"c6",a:"baaba",t:"ã‹ã‚ã„ã„ã€œï¼"},{id:"c7",a:"jiiji",t:"å¤§ãããªã£ãŸãªã"}]}
  ],
  glog:[{d:"2025-09",h:65,w:7,te:0},{d:"2025-10",h:66.5,w:7.3,te:0},{d:"2025-11",h:68,w:7.6,te:2},{d:"2025-12",h:69.5,w:7.9,te:2},{d:"2026-01",h:71,w:8.2,te:3},{d:"2026-02",h:72.5,w:8.6,te:4}]
};

const gm=(ms,id)=>ms.find(m=>m.id===id)||{name:"?",em:"ğŸ‘¤"};
function ld(){try{const r=localStorage.getItem(SK);return r?JSON.parse(r):null;}catch{return null;}}
function sv(d){try{localStorage.setItem(SK,JSON.stringify(d));}catch{}}

const Av=({em,sz=34})=><div style={{width:sz,height:sz,borderRadius:"50%",background:`linear-gradient(135deg,${C.wm},${C.bdr})`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:sz*.52,flexShrink:0}}>{em}</div>;
const Pill=({children,color=C.ac,on,onClick})=><button onClick={onClick} style={{display:"inline-flex",alignItems:"center",gap:2,fontSize:10,fontWeight:700,color:on?"#fff":color,background:on?color:color+"14",borderRadius:5,padding:"2px 7px",border:"none",cursor:onClick?"pointer":"default"}}>{children}</button>;

function PostCard({post,mems,usr,dispatch}){
  const[menu,setMenu]=useState(false);const[ct,setCt]=useState("");const[exp,setExp]=useState(false);const[pk,setPk]=useState(false);
  const au=gm(mems,post.author);const pt=PT[post.type]||PT.quick;const cms=post.cm||[];const sh=exp?cms:cms.slice(-2);
  const long=post.type==="blog"&&(post.text||"").length>160;
  return <div style={{background:C.card,borderRadius:14,border:`1px solid ${C.bdr}`,padding:"12px 14px",marginBottom:10,position:"relative"}}>
    <div style={{display:"flex",alignItems:"center",gap:8,marginBottom:8}}>
      <Av em={au.em} sz={34}/>
      <div style={{flex:1}}>
        <div style={{display:"flex",alignItems:"center",gap:4}}><span style={{fontSize:12,fontWeight:700,color:C.tx}}>{au.name}</span><Pill color={pt.c}>{pt.i} {pt.l}</Pill></div>
        <div style={{fontSize:10,color:C.lt}}>{fD(post.at)} {fT(post.at)}</div>
      </div>
      {post.author===usr&&<div style={{position:"relative"}}>
        <button onClick={()=>setMenu(!menu)} style={{background:"none",border:"none",fontSize:16,cursor:"pointer",color:C.lt}}>â‹¯</button>
        {menu&&<div style={{position:"absolute",right:0,top:"100%",background:"#fff",border:`1px solid ${C.bdr}`,borderRadius:8,boxShadow:"0 4px 14px rgba(0,0,0,.12)",zIndex:20,overflow:"hidden",minWidth:100}}>
          <button onClick={()=>{dispatch({t:"EDIT",post});setMenu(false);}} style={{display:"block",width:"100%",padding:"8px 12px",border:"none",background:"none",fontSize:11,cursor:"pointer",textAlign:"left"}}>âœï¸ ç·¨é›†</button>
          <button onClick={()=>{dispatch({t:"DEL",id:post.id});setMenu(false);}} style={{display:"block",width:"100%",padding:"8px 12px",border:"none",background:"none",fontSize:11,cursor:"pointer",textAlign:"left",color:"#c44"}}>ğŸ—‘ï¸ å‰Šé™¤</button>
        </div>}
      </div>}
    </div>
    {post.type==="blog"&&post.title&&<h3 style={{fontSize:16,fontWeight:800,color:C.tx,margin:"0 0 4px",lineHeight:1.35}}>{post.title}</h3>}
    {post.text&&<div style={{fontSize:13,lineHeight:1.75,color:C.mid,whiteSpace:"pre-wrap",wordBreak:"break-word"}}>{long&&!exp?post.text.slice(0,160)+"â€¦":post.text}{long&&!exp&&<button onClick={()=>setExp(true)} style={{background:"none",border:"none",color:C.bl,fontSize:11,fontWeight:700,cursor:"pointer",marginLeft:3}}>ç¶šãã‚’èª­ã‚€</button>}</div>}
    {post.photos&&post.photos.length>0&&<div style={{display:"grid",gridTemplateColumns:`repeat(${Math.min(post.photos.length,3)},1fr)`,gap:4,margin:"6px 0"}}>{post.photos.map((p,i)=><div key={i} style={{aspectRatio:post.photos.length===1?"16/10":"1",background:`linear-gradient(145deg,${C.wm},#e0d9ce)`,borderRadius:8,display:"flex",alignItems:"center",justifyContent:"center",fontSize:post.photos.length===1?36:24,border:`1px solid ${C.bdr}`}}>{p}</div>)}</div>}
    {post.type==="growth"&&post.gr&&<div style={{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:4,margin:"6px 0"}}>{[{e:"ğŸ“",l:"èº«é•·",v:post.gr.h,u:"cm"},{e:"âš–ï¸",l:"ä½“é‡",v:post.gr.w,u:"kg"},{e:"ğŸ¦·",l:"æ­¯",v:post.gr.te,u:"æœ¬"},{e:"ğŸŒ™",l:"ç¡çœ ",v:post.gr.sl,u:"h"}].map((g,i)=><div key={i} style={{textAlign:"center",background:C.gn+"0d",borderRadius:7,padding:"6px 1px"}}><div style={{fontSize:14}}>{g.e}</div><div style={{fontSize:8,color:C.lt}}>{g.l}</div><div style={{fontSize:16,fontWeight:800,color:C.gn}}>{g.v}<span style={{fontSize:9}}>{g.u}</span></div></div>)}</div>}
    {(post.ms||[]).map((m,i)=><div key={i} style={{background:C.gd+"10",borderRadius:6,padding:"5px 10px",margin:"4px 0",fontSize:11,fontWeight:700,color:C.gd}}>ğŸŒŸ {m}</div>)}
    {post.tags&&post.tags.length>0&&<div style={{display:"flex",gap:3,flexWrap:"wrap",margin:"4px 0"}}>{post.tags.map(t=><Pill key={t} color={C.ac}>#{t}</Pill>)}</div>}
    <div style={{borderTop:`1px solid ${C.bg}`,paddingTop:6,marginTop:5,display:"flex",alignItems:"center",gap:3,flexWrap:"wrap",position:"relative"}}>
      {Object.entries(post.rx||{}).map(([e,n])=><button key={e} onClick={()=>dispatch({t:"RX",id:post.id,e})} style={{background:C.wm,border:`1px solid ${C.bdr}`,borderRadius:14,padding:"1px 7px",cursor:"pointer",fontSize:11,display:"flex",alignItems:"center",gap:2}}>{e}<span style={{fontSize:10,color:C.mid,fontWeight:600}}>{n}</span></button>)}
      <div style={{position:"relative"}}><button onClick={()=>setPk(!pk)} style={{background:"none",border:`1px dashed ${C.bdr}`,borderRadius:14,padding:"1px 7px",cursor:"pointer",fontSize:10,color:C.lt}}>ï¼‹</button>
        {pk&&<div style={{position:"absolute",bottom:"110%",left:0,background:"#fff",border:`1px solid ${C.bdr}`,borderRadius:10,padding:"4px 5px",display:"flex",gap:2,zIndex:20,boxShadow:"0 3px 12px rgba(0,0,0,.12)"}}>{RCT.map(r=><button key={r} onClick={()=>{dispatch({t:"RX",id:post.id,e:r});setPk(false);}} style={{background:"none",border:"none",fontSize:17,cursor:"pointer",padding:1}}>{r}</button>)}</div>}
      </div>
    </div>
    {cms.length>2&&!exp&&<button onClick={()=>setExp(true)} style={{background:"none",border:"none",color:C.lt,fontSize:10,cursor:"pointer",padding:"3px 0"}}>ğŸ’¬ {cms.length}ä»¶ã™ã¹ã¦</button>}
    {sh.map(c=>{const m=gm(mems,c.a);return <div key={c.id} style={{display:"flex",gap:5,padding:"3px 0"}}><Av em={m.em} sz={20}/><div style={{fontSize:11,color:C.mid}}><strong style={{color:C.tx}}>{m.name}</strong> {c.t}</div></div>;})}
    <div style={{display:"flex",gap:4,marginTop:4}}>
      <input value={ct} onChange={e=>setCt(e.target.value)} onKeyDown={e=>{if(e.key==="Enter"&&ct.trim()){dispatch({t:"CM",id:post.id,tx:ct});setCt("");}}} placeholder="ã‚³ãƒ¡ãƒ³ãƒˆâ€¦" style={{flex:1,border:`1px solid ${C.bdr}`,borderRadius:16,padding:"4px 10px",fontSize:11,outline:"none",background:C.bg}}/>
      <button onClick={()=>{if(ct.trim()){dispatch({t:"CM",id:post.id,tx:ct});setCt("");}}} style={{background:ct.trim()?C.ac:C.wm,color:ct.trim()?"#fff":C.lt,border:"none",borderRadius:16,padding:"4px 10px",fontSize:10,fontWeight:700,cursor:"pointer"}}>é€ä¿¡</button>
    </div>
  </div>;
}

function Compose({ep,usr,dispatch,onClose}){
  const ie=!!ep;const[ty,setTy]=useState(ep?.type||"photo");const[tx,setTx]=useState(ep?.text||"");const[ti,setTi]=useState(ep?.title||"");
  const[tg,setTg]=useState((ep?.tags||[]).join(", "));const[gr,setGr]=useState(ep?.gr||{h:"",w:"",te:"",sl:""});
  const[ms,setMs]=useState((ep?.ms||[]).join(", "));const[ph,setPh]=useState(ep?.photos||[]);
  const emos=["ğŸ“·","ğŸŒ¸","ğŸ‚","ğŸ¼","ğŸ§¸","ğŸª","ğŸŒˆ","â›±ï¸","ğŸª","ğŸ§"];
  const go=()=>{const now=new Date().toISOString();const tags=tg.split(/[,ã€\s]+/).map(t=>t.replace("#","").trim()).filter(Boolean);
    const post={...(ep||{}),id:ep?.id||uid(),type:ty,author:ep?.author||usr,at:ep?.at||now,text:tx,title:ty==="blog"?ti:"",photos:["photo","blog"].includes(ty)?ph:[],tags,gr:ty==="growth"?{h:parseFloat(gr.h)||0,w:parseFloat(gr.w)||0,te:parseInt(gr.te)||0,sl:parseFloat(gr.sl)||0}:undefined,ms:ty==="growth"?ms.split(/[,ã€]/).filter(Boolean):undefined,rx:ep?.rx||{},cm:ep?.cm||[]};
    dispatch({t:ie?"UPD":"ADD",post});onClose();};
  return <div style={{position:"fixed",inset:0,background:"rgba(0,0,0,.4)",display:"flex",alignItems:"flex-end",justifyContent:"center",zIndex:100}} onClick={onClose}>
    <div style={{background:C.card,borderRadius:"18px 18px 0 0",width:"100%",maxWidth:480,maxHeight:"88vh",padding:"12px 14px 24px",overflowY:"auto"}} onClick={e=>e.stopPropagation()}>
      <div style={{width:30,height:3,borderRadius:2,background:C.bdr,margin:"0 auto 10px"}}/>
      <div style={{fontSize:14,fontWeight:800,color:C.tx,marginBottom:10}}>{ie?"âœï¸ ç·¨é›†":"âœ¨ æ–°ã—ã„æŠ•ç¨¿"}</div>
      {!ie&&<div style={{display:"flex",gap:4,marginBottom:12}}>{Object.entries(PT).map(([k,v])=><button key={k} onClick={()=>setTy(k)} style={{flex:1,padding:"7px 1px",borderRadius:8,border:ty===k?`2px solid ${v.c}`:`1px solid ${C.bdr}`,background:ty===k?v.c+"10":"#fff",cursor:"pointer",textAlign:"center"}}><div style={{fontSize:16}}>{v.i}</div><div style={{fontSize:9,fontWeight:700,color:ty===k?v.c:C.lt}}>{v.l}</div></button>)}</div>}
      {ty==="blog"&&<input value={ti} onChange={e=>setTi(e.target.value)} placeholder="ã‚¿ã‚¤ãƒˆãƒ«" style={{width:"100%",border:"none",borderBottom:`2px solid ${C.bdr}`,padding:"6px 0",fontSize:16,fontWeight:700,outline:"none",marginBottom:8,background:"transparent"}}/>}
      {ty==="growth"&&<><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:5,marginBottom:6}}>{[{k:"h",i:"ğŸ“",l:"èº«é•·cm",p:"72.5"},{k:"w",i:"âš–ï¸",l:"ä½“é‡kg",p:"8.6"},{k:"te",i:"ğŸ¦·",l:"æ­¯(æœ¬)",p:"4"},{k:"sl",i:"ğŸŒ™",l:"ç¡çœ h",p:"10.5"}].map(f=><div key={f.k} style={{background:C.gn+"0d",borderRadius:7,padding:6}}><div style={{fontSize:10,color:C.lt}}>{f.i}{f.l}</div><input value={gr[f.k]} onChange={e=>setGr({...gr,[f.k]:e.target.value})} placeholder={f.p} type="number" step="0.1" style={{width:"100%",border:"none",background:"#fff",borderRadius:5,padding:"4px 6px",fontSize:14,fontWeight:700,color:C.gn,outline:"none"}}/></div>)}</div><input value={ms} onChange={e=>setMs(e.target.value)} placeholder="ğŸŒŸ ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³" style={{width:"100%",border:`1px solid ${C.bdr}`,borderRadius:8,padding:"6px 8px",fontSize:12,outline:"none",marginBottom:6,background:C.bg}}/></>}
      <textarea value={tx} onChange={e=>setTx(e.target.value)} placeholder={ty==="blog"?"è¨˜äº‹ã‚’æ›¸ãâ€¦":"ãƒ†ã‚­ã‚¹ãƒˆâ€¦"} style={{width:"100%",minHeight:ty==="blog"?120:55,border:`1px solid ${C.bdr}`,borderRadius:8,padding:8,fontSize:12,lineHeight:1.7,resize:"vertical",outline:"none",background:C.bg}}/>
      {["photo","blog"].includes(ty)&&<div style={{marginTop:6}}><div style={{display:"flex",gap:3,flexWrap:"wrap",marginBottom:4}}>{ph.map((p,i)=><div key={i} style={{width:34,height:34,borderRadius:6,background:C.wm,display:"flex",alignItems:"center",justifyContent:"center",fontSize:18,position:"relative",border:`1px solid ${C.bdr}`}}>{p}<button onClick={()=>setPh(ph.filter((_,j)=>j!==i))} style={{position:"absolute",top:-5,right:-5,width:14,height:14,borderRadius:"50%",background:C.ac,color:"#fff",border:"none",fontSize:8,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"}}>âœ•</button></div>)}</div><div style={{display:"flex",gap:3,flexWrap:"wrap"}}>{emos.map(e=><button key={e} onClick={()=>setPh([...ph,e])} style={{width:28,height:28,borderRadius:5,border:`1px solid ${C.bdr}`,background:"#fff",fontSize:14,cursor:"pointer"}}>{e}</button>)}</div></div>}
      <input value={tg} onChange={e=>setTg(e.target.value)} placeholder="ğŸ·ï¸ ã‚¿ã‚°ï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰" style={{width:"100%",border:`1px solid ${C.bdr}`,borderRadius:8,padding:"5px 8px",fontSize:11,outline:"none",marginTop:6,background:C.bg}}/>
      <div style={{display:"flex",gap:6,marginTop:12}}>
        <button onClick={onClose} style={{flex:1,padding:10,borderRadius:10,border:`1px solid ${C.bdr}`,background:"#fff",fontSize:12,fontWeight:700,cursor:"pointer",color:C.mid}}>ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button onClick={go} style={{flex:2,padding:10,borderRadius:10,border:"none",background:`linear-gradient(135deg,${C.ac},#d47055)`,fontSize:12,fontWeight:700,cursor:"pointer",color:"#fff"}}>{ie?"æ›´æ–° âœï¸":"å…±æœ‰ âœ¨"}</button>
      </div>
    </div>
  </div>;
}

function Growth({glog}){
  const[mk,setMk]=useState("h");const ms=[{k:"h",l:"èº«é•·cm",c:C.ac},{k:"w",l:"ä½“é‡kg",c:C.bl},{k:"te",l:"æ­¯",c:C.gn}];const mc=ms.find(m=>m.k===mk);
  if(!glog||glog.length<2)return <div style={{padding:30,textAlign:"center",color:C.lt}}>æˆé•·ãƒ­ã‚°ã‚’2å›ä»¥ä¸Šè¨˜éŒ²ã™ã‚‹ã¨ã‚°ãƒ©ãƒ•è¡¨ç¤º</div>;
  const W=320,H=150,PX=30,PY=14;const vs=glog.map(g=>g[mk]);const mn=Math.floor(Math.min(...vs)-1);const mx=Math.ceil(Math.max(...vs)+1);const rg=mx-mn||1;const xs=(W-PX*2)/(glog.length-1);
  const pts=glog.map((g,i)=>({x:PX+i*xs,y:PY+(1-(g[mk]-mn)/rg)*(H-PY*2),v:g[mk],lb:g.d.slice(5)}));
  const pD=pts.map((p,i)=>`${i?'L':'M'}${p.x},${p.y}`).join("");const lastPt=pts[pts.length-1];const aD=pD+`L${lastPt.x},${H-PY}L${pts[0].x},${H-PY}Z`;
  return <div>
    <div style={{fontSize:15,fontWeight:800,color:C.tx,marginBottom:10}}>ğŸ“Š æˆé•·è¨˜éŒ²</div>
    <div style={{background:C.card,borderRadius:12,border:`1px solid ${C.bdr}`,padding:12,marginBottom:12}}>
      <div style={{display:"flex",gap:4,marginBottom:8}}>{ms.map(m=><Pill key={m.k} color={m.c} on={mk===m.k} onClick={()=>setMk(m.k)}>{m.l}</Pill>)}</div>
      <svg viewBox={`0 0 ${W} ${H}`} style={{width:"100%"}}>{[0,.25,.5,.75,1].map(r=>{const y=PY+r*(H-PY*2);return <line key={r} x1={PX} x2={W-PX} y1={y} y2={y} stroke={C.bdr} strokeWidth={.5}/>;})}<path d={aD} fill={mc.c+"15"}/><path d={pD} fill="none" stroke={mc.c} strokeWidth={2} strokeLinecap="round" strokeLinejoin="round"/>{pts.map((p,i)=><circle key={i} cx={p.x} cy={p.y} r={3} fill="#fff" stroke={mc.c} strokeWidth={1.5}/>)}{pts.map((p,i)=><text key={`v${i}`} x={p.x} y={p.y-8} textAnchor="middle" fill={mc.c} fontSize={7} fontWeight={700}>{p.v}</text>)}{pts.map((p,i)=><text key={`l${i}`} x={p.x} y={H-2} textAnchor="middle" fill={C.lt} fontSize={6}>{p.lb}</text>)}</svg>
    </div>
    <div style={{background:C.card,borderRadius:12,border:`1px solid ${C.bdr}`,overflow:"hidden"}}><div style={{padding:"8px 12px",borderBottom:`1px solid ${C.bdr}`,fontSize:12,fontWeight:700,color:C.mid}}>è¨˜éŒ²ä¸€è¦§</div>{[...glog].reverse().map((g,i)=><div key={i} style={{display:"flex",gap:8,padding:"6px 12px",background:i%2?C.bg:"#fff",fontSize:11}}><span style={{minWidth:42,color:C.lt,fontWeight:600}}>{g.d.slice(5)}</span><span>ğŸ“{g.h}cm</span><span>âš–ï¸{g.w}kg</span><span>ğŸ¦·{g.te}</span></div>)}</div>
  </div>;
}

function News({posts,mems,glog}){
  const scored=useMemo(()=>[...posts].map(p=>{let s=0;if((p.tags||[]).includes("ã¯ã˜ã‚ã¦"))s+=50;s+=Object.values(p.rx||{}).reduce((a,v)=>a+v,0)*3;s+=(p.cm||[]).length*5;s+=(p.photos||[]).length*4;if(p.type==="blog")s+=15;if(p.ms&&p.ms.length)s+=30;return{...p,score:s};}).sort((a,b)=>b.score-a.score),[posts]);
  const top=scored[0];const sub=scored.slice(1,4);const lg=glog&&glog.length>0?glog[glog.length-1]:null;
  return <div>
    <div style={{fontSize:15,fontWeight:800,color:C.tx,marginBottom:10}}>ğŸ“° ä»Šé€±ã®ã¨ã‚‚ãˆå®¶æ–°è</div>
    <div style={{background:"#f5f0e7",borderRadius:12,border:`1px solid ${C.bdr}`,overflow:"hidden",boxShadow:"0 2px 10px rgba(0,0,0,.07)"}}>
      <div style={{background:C.dk,padding:"10px 14px",textAlign:"center"}}><div style={{height:3,background:"rgba(255,255,255,.8)",marginBottom:2}}/><div style={{height:1,background:"rgba(255,255,255,.3)",marginBottom:5}}/><div style={{display:"flex",justifyContent:"space-between",fontSize:8,color:"rgba(255,255,255,.4)",marginBottom:3}}><span>ä»¤å’Œ8å¹´ 2æœˆ18æ—¥</span><span style={{background:C.ac,color:"#fff",padding:"0 6px",borderRadius:2,fontWeight:700}}>è‡ªå‹•ç”Ÿæˆ</span></div><div style={{fontSize:22,fontWeight:900,color:"#fff",letterSpacing:".1em"}}>ã¨ã‚‚ãˆå®¶æ–°è</div><div style={{fontSize:7,color:"rgba(255,255,255,.3)",letterSpacing:".3em"}}>TOMOE FAMILY NEWS</div></div>
      <div style={{padding:12}}>
        {top&&<div style={{marginBottom:10}}><div style={{fontSize:9,fontWeight:700,color:C.ac,marginBottom:2}}>â–ãƒˆãƒƒãƒ— <span style={{color:C.lt,fontWeight:500}}>({top.score}pt)</span></div><div style={{fontSize:16,fontWeight:900,color:C.tx,lineHeight:1.3,marginBottom:5}}>{top.title||(top.text||"").slice(0,30)}</div>{top.photos&&top.photos.length>0&&<div style={{height:75,background:`linear-gradient(145deg,${C.wm},#ddd7cc)`,borderRadius:7,display:"flex",alignItems:"center",justifyContent:"center",fontSize:28,gap:6,marginBottom:5}}>{top.photos.slice(0,3).map((p,i)=><span key={i}>{p}</span>)}</div>}<div style={{fontSize:11,lineHeight:1.65,color:C.mid}}>{(top.text||"").slice(0,110)}â€¦</div></div>}
        {sub.length>0&&<React.Fragment><div style={{height:1,background:C.bdr,margin:"6px 0"}}/><div style={{display:"grid",gridTemplateColumns:sub.length>=2?"1fr 1fr":"1fr",gap:6}}>{sub.map(p=><div key={p.id} style={{background:"#fff",borderRadius:7,padding:8,border:`1px solid ${C.bdr}`}}><div style={{fontSize:8,color:PT[p.type]?PT[p.type].c:C.lt,fontWeight:700,marginBottom:1}}>{PT[p.type]?PT[p.type].i:""} {PT[p.type]?PT[p.type].l:""}</div><div style={{fontSize:11,fontWeight:700,color:C.tx,marginBottom:2}}>{p.title||(p.text||"").slice(0,20)}</div><div style={{fontSize:9,color:C.lt,lineHeight:1.4}}>{(p.text||"").slice(0,50)}â€¦</div></div>)}</div></React.Fragment>}
        {lg&&<React.Fragment><div style={{height:1,background:C.bdr,margin:"8px 0"}}/><div style={{display:"flex",justifyContent:"space-around",padding:"4px 0"}}>{[{e:"ğŸ“",v:lg.h,u:"cm"},{e:"âš–ï¸",v:lg.w,u:"kg"},{e:"ğŸ¦·",v:lg.te,u:"æœ¬"}].map((g,i)=><div key={i} style={{textAlign:"center"}}><div style={{fontSize:12}}>{g.e}</div><div style={{fontSize:15,fontWeight:800,color:C.ac}}>{g.v}<span style={{fontSize:8}}>{g.u}</span></div></div>)}</div></React.Fragment>}
        <div style={{textAlign:"center",marginTop:8,paddingTop:8,borderTop:`1px solid ${C.bdr}`}}><div style={{fontSize:8,fontWeight:700,color:C.ac,letterSpacing:".04em"}}>FamilyPress â”€ ã™ã¹ã¦ã®å®¶æ—ã«ã€è‡ªåˆ†ãŸã¡ã ã‘ã®ãƒ¡ãƒ‡ã‚£ã‚¢ã‚’ã€‚</div></div>
      </div>
    </div>
  </div>;
}

function Settings({data,dispatch}){
  const[fn,setFn]=useState(data.family);const[nn,setNn]=useState("");const[ne,setNe]=useState("ğŸ‘¤");
  return <div>
    <div style={{background:C.card,borderRadius:12,border:`1px solid ${C.bdr}`,padding:12,marginBottom:10}}>
      <div style={{fontSize:13,fontWeight:800,color:C.tx,marginBottom:8}}>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ ãƒ•ã‚¡ãƒŸãƒªãƒ¼</div>
      <div style={{display:"flex",gap:5,marginBottom:10}}><input value={fn} onChange={e=>setFn(e.target.value)} style={{flex:1,border:`1px solid ${C.bdr}`,borderRadius:7,padding:"5px 8px",fontSize:12,outline:"none"}}/><button onClick={()=>dispatch({t:"FAM",n:fn})} style={{padding:"5px 12px",borderRadius:7,border:"none",background:C.ac,color:"#fff",fontSize:11,fontWeight:700,cursor:"pointer"}}>ä¿å­˜</button></div>
      <div style={{fontSize:11,color:C.mid,marginBottom:5}}>ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ‡æ›¿</div>
      <div style={{display:"flex",gap:4,marginBottom:10}}>{data.members.filter(m=>m.role==="admin").map(m=><Pill key={m.id} color={C.bl} on={data.user===m.id} onClick={()=>dispatch({t:"USR",id:m.id})}>{m.em} {m.name}</Pill>)}</div>
      <div style={{fontSize:11,color:C.mid,marginBottom:5}}>ãƒ¡ãƒ³ãƒãƒ¼</div>
      {data.members.map(m=><div key={m.id} style={{display:"flex",alignItems:"center",gap:6,padding:"5px 0",borderBottom:`1px solid ${C.bg}`}}><Av em={m.em} sz={26}/><span style={{flex:1,fontSize:12,fontWeight:600}}>{m.name}</span><Pill color={m.role==="admin"?C.gn:C.lt}>{m.role==="admin"?"æŠ•ç¨¿è€…":"é–²è¦§è€…"}</Pill><button onClick={()=>dispatch({t:"RMMEM",id:m.id})} style={{background:"none",border:"none",cursor:"pointer",color:C.lt}}>âœ•</button></div>)}
      <div style={{display:"flex",gap:4,marginTop:8}}><input value={ne} onChange={e=>setNe(e.target.value)} style={{width:32,border:`1px solid ${C.bdr}`,borderRadius:5,padding:3,fontSize:14,textAlign:"center",outline:"none"}}/><input value={nn} onChange={e=>setNn(e.target.value)} placeholder="åå‰" style={{flex:1,border:`1px solid ${C.bdr}`,borderRadius:5,padding:"4px 7px",fontSize:11,outline:"none"}}/><button onClick={()=>{if(nn.trim()){dispatch({t:"ADDMEM",m:{id:uid(),name:nn,em:ne||"ğŸ‘¤",role:"viewer"}});setNn("");setNe("ğŸ‘¤");}}} style={{padding:"4px 10px",borderRadius:5,border:"none",background:C.gn,color:"#fff",fontSize:10,fontWeight:700,cursor:"pointer"}}>è¿½åŠ </button></div>
    </div>
    <div style={{background:C.card,borderRadius:12,border:`1px solid ${C.bdr}`,padding:12,marginBottom:10}}>
      <div style={{fontSize:13,fontWeight:800,color:C.tx,marginBottom:8}}>ğŸ”— å¤–éƒ¨é€£æº</div>
      {[{i:"ğŸ«",n:"ã‚³ãƒ‰ãƒ¢ãƒ³"},{i:"ğŸ«",n:"ãƒ«ã‚¯ãƒŸãƒ¼"},{i:"ğŸ“·",n:"Google Photos"},{i:"ğŸ’¬",n:"LINE Bot"},{i:"ğŸ“…",n:"Calendar"}].map(s=><div key={s.n} style={{display:"flex",alignItems:"center",gap:6,padding:"6px 0",borderBottom:`1px solid ${C.bg}`}}><span style={{fontSize:16}}>{s.i}</span><span style={{flex:1,fontSize:12}}>{s.n}</span><span style={{fontSize:9,color:C.lt,background:C.wm,padding:"2px 8px",borderRadius:8}}>æº–å‚™ä¸­</span></div>)}
    </div>
    <div style={{background:C.card,borderRadius:12,border:`1px solid ${C.bdr}`,padding:12}}>
      <div style={{fontSize:13,fontWeight:800,color:C.tx,marginBottom:8}}>ğŸ“Š çµ±è¨ˆ</div>
      <div style={{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:5}}>{[{l:"æŠ•ç¨¿",v:data.posts.length},{l:"å†™çœŸ",v:data.posts.reduce((a,p)=>a+(p.photos||[]).length,0)},{l:"ã‚³ãƒ¡ãƒ³ãƒˆ",v:data.posts.reduce((a,p)=>a+(p.cm||[]).length,0)}].map(s=><div key={s.l} style={{textAlign:"center",background:C.bg,borderRadius:7,padding:7}}><div style={{fontSize:18,fontWeight:800,color:C.ac}}>{s.v}</div><div style={{fontSize:9,color:C.lt}}>{s.l}</div></div>)}</div>
      <button onClick={()=>{if(confirm("ãƒªã‚»ãƒƒãƒˆï¼Ÿ"))dispatch({t:"RESET"});}} style={{width:"100%",marginTop:10,padding:8,borderRadius:8,border:"1px solid #daa",background:"#fef5f5",color:"#c55",fontSize:11,fontWeight:700,cursor:"pointer"}}>ğŸ—‘ï¸ ãƒªã‚»ãƒƒãƒˆ</button>
    </div>
  </div>;
}

function App(){
  const[D,setD]=useState(()=>ld()||INIT);const[tab,setTab]=useState("home");const[cmp,setCmp]=useState(false);const[ep,setEp]=useState(null);const[ft,setFt]=useState(null);
  useEffect(()=>{sv(D);},[D]);
  const dispatch=useCallback((a)=>{setD(prev=>{if(!prev)return prev;switch(a.t){
    case "ADD":{let d={...prev,posts:[a.post,...prev.posts]};if(a.post.type==="growth"&&a.post.gr){const e={d:a.post.at.slice(0,7),h:a.post.gr.h,w:a.post.gr.w,te:a.post.gr.te};d.glog=[...(prev.glog||[]).filter(g=>g.d!==e.d),e].sort((a,b)=>a.d.localeCompare(b.d));}return d;}
    case "UPD":{let d={...prev,posts:prev.posts.map(p=>p.id===a.post.id?a.post:p)};if(a.post.type==="growth"&&a.post.gr){const e={d:a.post.at.slice(0,7),h:a.post.gr.h,w:a.post.gr.w,te:a.post.gr.te};d.glog=[...(prev.glog||[]).filter(g=>g.d!==e.d),e].sort((a,b)=>a.d.localeCompare(b.d));}return d;}
    case "DEL":return{...prev,posts:prev.posts.filter(p=>p.id!==a.id)};
    case "RX":return{...prev,posts:prev.posts.map(p=>{if(p.id!==a.id)return p;const r={...(p.rx||{})};r[a.e]=(r[a.e]||0)+1;return{...p,rx:r};})};
    case "CM":return{...prev,posts:prev.posts.map(p=>{if(p.id!==a.id)return p;return{...p,cm:[...(p.cm||[]),{id:uid(),a:prev.user,t:a.tx}]};})};
    case "EDIT":setEp(a.post);setCmp(true);return prev;
    case "FAM":return{...prev,family:a.n};case "USR":return{...prev,user:a.id};
    case "ADDMEM":return{...prev,members:[...prev.members,a.m]};
    case "RMMEM":return{...prev,members:prev.members.filter(m=>m.id!==a.id)};
    case "RESET":return INIT;default:return prev;}});},[]);

  const sorted=useMemo(()=>{let p=[...D.posts].sort((a,b)=>new Date(b.at)-new Date(a.at));if(ft)p=p.filter(x=>x.type===ft);return p;},[D.posts,ft]);
  const grouped=useMemo(()=>{const g={};sorted.forEach(p=>{const d=fD(p.at);if(!g[d])g[d]=[];g[d].push(p);});return g;},[sorted]);
  const cu=gm(D.members,D.user);
  const tabs=[{id:"home",i:"ğŸ ",l:"ãƒ›ãƒ¼ãƒ "},{id:"news",i:"ğŸ“°",l:"æ–°è"},{id:"grow",i:"ğŸ“Š",l:"æˆé•·"},{id:"set",i:"âš™ï¸",l:"è¨­å®š"}];

  return <div style={{maxWidth:480,margin:"0 auto",minHeight:"100vh",background:C.bg,position:"relative",fontFamily:"-apple-system,'Hiragino Sans',sans-serif"}}>
    <div style={{padding:"10px 14px 7px",background:`linear-gradient(180deg,${C.card},${C.bg})`,position:"sticky",top:0,zIndex:50,borderBottom:`1px solid ${C.bdr}`}}>
      <div style={{display:"flex",alignItems:"center",justifyContent:"space-between"}}>
        <div><div style={{fontSize:17,fontWeight:900}}><span style={{color:C.ac}}>Family</span><span style={{color:C.tx}}>Press</span></div><div style={{fontSize:9,color:C.lt}}>ğŸ  {D.family} Â· {cu.em}{cu.name}</div></div>
        <div style={{display:"flex",gap:4}}>{D.members.slice(0,4).map(m=><Av key={m.id} em={m.em} sz={26}/>)}</div>
      </div>
    </div>
    <div style={{padding:"8px 12px 90px"}}>
      {tab==="home"&&<React.Fragment>
        <div onClick={()=>setTab("news")} style={{background:`linear-gradient(135deg,${C.dk},${C.dk}dd)`,borderRadius:10,padding:"10px 12px",marginBottom:8,display:"flex",alignItems:"center",gap:10,cursor:"pointer"}}>
          <div style={{width:36,height:36,borderRadius:8,background:`linear-gradient(135deg,${C.ac},#d47055)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:18,flexShrink:0}}>ğŸ“°</div>
          <div style={{flex:1}}><div style={{fontSize:11,fontWeight:800,color:"#fff"}}>ä»Šé€±å·ã‚’èª­ã‚€</div><div style={{fontSize:9,color:"rgba(255,255,255,.45)"}}>æŠ•ç¨¿{D.posts.length}ä»¶ã‹ã‚‰è‡ªå‹•æ§‹æˆ</div></div>
          <div style={{fontSize:9,fontWeight:700,color:C.ac,background:"rgba(255,255,255,.9)",padding:"3px 8px",borderRadius:10}}>â†’</div>
        </div>
        <div style={{display:"flex",gap:3,marginBottom:8,overflowX:"auto",paddingBottom:2}}>
          <Pill color={C.mid} on={!ft} onClick={()=>setFt(null)}>ã™ã¹ã¦</Pill>
          {Object.entries(PT).map(([k,v])=><Pill key={k} color={v.c} on={ft===k} onClick={()=>setFt(ft===k?null:k)}>{v.i}{v.l}</Pill>)}
        </div>
        {Object.entries(grouped).map(([date,dp])=><div key={date}>
          <div style={{display:"flex",alignItems:"center",gap:6,margin:"3px 0 6px"}}><div style={{flex:1,height:1,background:C.bdr}}/><span style={{fontSize:10,fontWeight:700,color:C.lt}}>{date}</span><div style={{flex:1,height:1,background:C.bdr}}/></div>
          {dp.map(p=><PostCard key={p.id} post={p} mems={D.members} usr={D.user} dispatch={dispatch}/>)}
        </div>)}
        {sorted.length===0&&<div style={{textAlign:"center",padding:30,color:C.lt,fontSize:12}}>ã¾ã æŠ•ç¨¿ãŒã‚ã‚Šã¾ã›ã‚“ ğŸ“</div>}
      </React.Fragment>}
      {tab==="news"&&<News posts={D.posts} mems={D.members} glog={D.glog}/>}
      {tab==="grow"&&<Growth glog={D.glog}/>}
      {tab==="set"&&<Settings data={D} dispatch={dispatch}/>}
    </div>
    {tab==="home"&&<button onClick={()=>{setEp(null);setCmp(true);}} style={{position:"fixed",bottom:68,right:"max(14px,calc(50% - 220px))",width:48,height:48,borderRadius:"50%",background:`linear-gradient(135deg,${C.ac},#d47055)`,border:"none",color:"#fff",fontSize:22,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:`0 3px 14px ${C.ac}40`,zIndex:40}}>+</button>}
    <div style={{position:"fixed",bottom:0,left:"50%",transform:"translateX(-50%)",width:"100%",maxWidth:480,background:"rgba(255,255,255,.93)",backdropFilter:"blur(12px)",borderTop:`1px solid ${C.bdr}`,display:"flex",padding:"5px 0 8px",zIndex:50}}>
      {tabs.map(t=><button key={t.id} onClick={()=>setTab(t.id)} style={{flex:1,background:"none",border:"none",display:"flex",flexDirection:"column",alignItems:"center",gap:0,cursor:"pointer"}}><span style={{fontSize:17,filter:tab===t.id?"none":"grayscale(.7)"}}>{t.i}</span><span style={{fontSize:8,fontWeight:tab===t.id?700:500,color:tab===t.id?C.ac:C.lt}}>{t.l}</span></button>)}
    </div>
    {cmp&&<Compose ep={ep} usr={D.user} dispatch={dispatch} onClose={()=>{setCmp(false);setEp(null);}}/>}
  </div>;
}

ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
</script>
</body>
</html>
