<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Universal File Previewer</title>

<!-- React & Babel -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>

<!-- Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>
<script>
  // Tailwind config with animation plugin
  tailwind.config = {
    theme: {
      extend: {
        animation: {
          'in': 'enter 0.3s ease-out',
          'spin': 'spin 1s linear infinite',
          'pulse': 'pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
        },
        keyframes: {
          enter: {
            '0%': { opacity: '0', transform: 'translateY(10px) scale(0.95)' },
            '100%': { opacity: '1', transform: 'translateY(0) scale(1)' },
          },
        },
      },
    },
  };
</script>
<style>
  /* Tailwind animate-in utilities */
  .animate-in { animation: enter 0.3s ease-out; }
  .fade-in { --tw-enter-opacity: 0; }
  .zoom-in { --tw-enter-scale: 0.95; }
  .zoom-in-50 { --tw-enter-scale: 0.5; }
  .slide-in-from-bottom-20 { --tw-enter-translate-y: 5rem; }
  .slide-in-from-bottom-4 { --tw-enter-translate-y: 1rem; }
  .slide-in-from-bottom-2 { --tw-enter-translate-y: 0.5rem; }
  .slide-in-from-right-24 { --tw-enter-translate-x: 6rem; }
  .duration-300 { animation-duration: 0.3s; }
  .duration-500 { animation-duration: 0.5s; }
  .duration-700 { animation-duration: 0.7s; }
  @keyframes enter {
    from {
      opacity: var(--tw-enter-opacity, 1);
      transform: translate(var(--tw-enter-translate-x, 0), var(--tw-enter-translate-y, 0)) scale(var(--tw-enter-scale, 1));
    }
  }
</style>

<!-- Lucide Icons - React Compatible Shim -->
<script>
// Comprehensive LucideReact shim - creates SVG-based React components
(function() {
  const icons = {
    // Navigation & Arrows
    Plus: 'M12 5v14M5 12h14', 
    X: 'M18 6L6 18M6 6l12 12',
    Check: 'M20 6L9 17l-5-5',
    ChevronLeft: 'M15 18l-6-6 6-6', 
    ChevronRight: 'M9 18l6-6-6-6', 
    ChevronUp: 'M18 15l-6-6-6 6', 
    ChevronDown: 'M6 9l6 6 6-6',
    ChevronsLeft: 'M11 17l-5-5 5-5m7 10l-5-5 5-5',
    ChevronsRight: 'M13 17l5-5-5-5M6 17l5-5-5-5',
    ArrowLeft: 'M19 12H5m7 7l-7-7 7-7', 
    ArrowRight: 'M5 12h14m-7-7l7 7-7 7', 
    ArrowUp: 'M12 19V5m-7 7l7-7 7 7', 
    ArrowDown: 'M12 5v14m7-7l-7 7-7-7',
    
    // UI Elements
    Menu: 'M4 6h16M4 12h16M4 18h16',
    Search: 'M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z',
    MoreHorizontal: 'M12 13a1 1 0 100-2 1 1 0 000 2zm7 0a1 1 0 100-2 1 1 0 000 2zM5 13a1 1 0 100-2 1 1 0 000 2z',
    MoreVertical: 'M12 13a1 1 0 100-2 1 1 0 000 2zm0-7a1 1 0 100-2 1 1 0 000 2zm0 14a1 1 0 100-2 1 1 0 000 2z',
    
    // Layout & View
    LayoutGrid: 'M3 3h7v7H3V3zm11 0h7v7h-7V3zm0 11h7v7h-7v-7zM3 14h7v7H3v-7z',
    Grid: 'M3 3h7v7H3V3zm11 0h7v7h-7V3zm0 11h7v7h-7v-7zM3 14h7v7H3v-7z',
    List: 'M8 6h13M8 12h13M8 18h13M3 6h.01M3 12h.01M3 18h.01',
    Sidebar: 'M19 3H5a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2V5a2 2 0 00-2-2zM9 3v18',
    Layout: 'M19 3H5a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2V5a2 2 0 00-2-2zM3 9h18M9 21V9',
    Layers: 'M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5',
    Monitor: 'M20 3H4a2 2 0 00-2 2v10a2 2 0 002 2h16a2 2 0 002-2V5a2 2 0 00-2-2zM8 21h8m-4-4v4',
    Maximize2: 'M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7',
    Minimize2: 'M4 14h6v6M20 10h-6V4M14 10l7-7M3 21l7-7',
    Maximize: 'M8 3H5a2 2 0 00-2 2v3m18 0V5a2 2 0 00-2-2h-3m0 18h3a2 2 0 002-2v-3M3 16v3a2 2 0 002 2h3',
    
    // Files & Folders
    File: 'M13 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V9l-7-7zM13 2v7h7',
    FileText: 'M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8l-6-6zM14 2v6h6m-4 5H8m8 4H8m2-8H8',
    FileCode: 'M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8l-6-6zM14 2v6h6m-8 5l-2 2 2 2m4-4l2 2-2 2',
    FileUp: 'M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8l-6-6zM14 2v6h6M12 12v6m-3-3l3-3 3 3',
    FilePlus: 'M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8l-6-6zM14 2v6h6M12 18v-6m-3 3h6',
    Folder: 'M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2v11z',
    FolderOpen: 'M6 14l1.45-2.9A2 2 0 019.24 10H20a2 2 0 011.94 2.5l-1.55 6a2 2 0 01-1.94 1.5H4a2 2 0 01-2-2V5c0-1.1.9-2 2-2h3.93a2 2 0 011.66.9l.82 1.2a2 2 0 001.66.9H18a2 2 0 012 2v2',
    
    // Actions
    Save: 'M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2zM17 21v-8H7v8M7 3v5h8',
    Download: 'M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4m4-5l5 5 5-5m-5 5V3',
    Upload: 'M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4m14-7l-5-5-5 5m5-5v12',
    FileSearch: 'M4 22h14a2 2 0 002-2V7.5L14.5 2H6a2 2 0 00-2 2v3m14 0V2l6 6h-6M4 14a3 3 0 100 6 3 3 0 000-6zm-2.5 7.5L4 19',
    Trash: 'M3 6h18m-2 0v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2',
    Trash2: 'M3 6h18m-2 0v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2m-6 5v6m4-6v6',
    Edit: 'M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z',
    Edit2: 'M17 3a2.828 2.828 0 114 4L7.5 20.5 2 22l1.5-5.5L17 3z',
    Edit3: 'M12 20h9M16.5 3.5a2.121 2.121 0 013 3L7 19l-4 1 1-4L16.5 3.5z',
    Copy: 'M20 9h-9a2 2 0 00-2 2v9a2 2 0 002 2h9a2 2 0 002-2v-9a2 2 0 00-2-2zM5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1',
    Share: 'M4 12v8a2 2 0 002 2h12a2 2 0 002-2v-8m-4-6l-4-4-4 4m4-4v13',
    Link: 'M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71',
    ExternalLink: 'M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6m4-3h6v6m-11 5L21 3',
    RefreshCw: 'M23 4v6h-6M1 20v-6h6M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15',
    RotateCw: 'M23 4v6h-6M20.49 15a9 9 0 11-2.12-9.36L23 10',
    
    // Settings & Tools  
    Settings: 'M12 15a3 3 0 100-6 3 3 0 000 6zM19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z',
    Settings2: 'M4 21v-7m0-4V3m8 18v-9m0-4V3m8 18v-5m0-4V3M1 14h6m2-6h6m2 8h6',
    Filter: 'M22 3H2l8 9.46V19l4 2v-8.54L22 3z',
    
    // Media & Content
    Image: 'M19 3H5a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2V5a2 2 0 00-2-2zM8.5 10a1.5 1.5 0 100-3 1.5 1.5 0 000 3zM21 15l-5-5L5 21',
    Video: 'M23 7l-7 5 7 5V7zM14 5H3a2 2 0 00-2 2v10a2 2 0 002 2h11a2 2 0 002-2V7a2 2 0 00-2-2z',
    Play: 'M5 3l14 9-14 9V3z',
    Pause: 'M6 4h4v16H6V4zm8 0h4v16h-4V4z',
    Volume2: 'M11 5L6 9H2v6h4l5 4V5zm8.07-.07a10 10 0 010 14.14M15.54 8.46a5 5 0 010 7.07',
    VolumeX: 'M11 5L6 9H2v6h4l5 4V5zm12 4l-6 6m0-6l6 6',
    Mic: 'M12 1a3 3 0 00-3 3v8a3 3 0 006 0V4a3 3 0 00-3-3zm7 9v2a7 7 0 01-14 0v-2m7 9v4m-4 0h8',
    Camera: 'M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2v11zM12 17a4 4 0 100-8 4 4 0 000 8z',
    
    // Communication
    MessageSquare: 'M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z',
    MessageCircle: 'M21 11.5a8.38 8.38 0 01-.9 3.8 8.5 8.5 0 01-7.6 4.7 8.38 8.38 0 01-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 01-.9-3.8 8.5 8.5 0 014.7-7.6 8.38 8.38 0 013.8-.9h.5a8.48 8.48 0 018 8v.5z',
    Mail: 'M4 4h16a2 2 0 012 2v12a2 2 0 01-2 2H4a2 2 0 01-2-2V6a2 2 0 012-2zm18 2l-10 7L2 6',
    Send: 'M22 2L11 13m11-11l-7 20-4-9-9-4 20-7z',
    Bell: 'M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9M13.73 21a2 2 0 01-3.46 0',
    
    // Status & Indicators
    AlertCircle: 'M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10zM12 8v4m0 4h.01',
    AlertTriangle: 'M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0zM12 9v4m0 4h.01',
    Info: 'M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10zM12 16v-4m0-4h.01',
    HelpCircle: 'M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10zM9.09 9a3 3 0 015.83 1c0 2-3 3-3 3m.08 4h.01',
    CheckCircle: 'M22 11.08V12a10 10 0 11-5.93-9.14M22 4L12 14.01l-3-3',
    XCircle: 'M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10zM15 9l-6 6m0-6l6 6',
    PlusCircle: 'M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10zM12 8v8m-4-4h8',
    MinusCircle: 'M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10zM8 12h8',
    
    // Loading
    Loader: 'M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48 8.48l2.83 2.83M2 12h4m12 0h4M4.93 19.07l2.83-2.83m8.48-8.48l2.83-2.83',
    Loader2: 'M21 12a9 9 0 11-6.219-8.56',
    RefreshCcw: 'M1 4v6h6M23 20v-6h-6M20.49 9A9 9 0 005.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 013.51 15',
    
    // Misc
    Globe: 'M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10zM2 12h20M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z',
    Home: 'M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2V9z',
    User: 'M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2M12 11a4 4 0 100-8 4 4 0 000 8z',
    Users: 'M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2M9 11a4 4 0 100-8 4 4 0 000 8zm14 10v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75',
    Heart: 'M20.84 4.61a5.5 5.5 0 00-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 00-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 000-7.78z',
    Star: 'M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z',
    Zap: 'M13 2L3 14h9l-1 8 10-12h-9l1-8z',
    Sparkles: 'M12 3l1.912 5.813a2 2 0 001.275 1.275L21 12l-5.813 1.912a2 2 0 00-1.275 1.275L12 21l-1.912-5.813a2 2 0 00-1.275-1.275L3 12l5.813-1.912a2 2 0 001.275-1.275L12 3zM5 3v4M19 17v4M3 5h4m10 14h4',
    Award: 'M12 15a7 7 0 100-14 7 7 0 000 14zm-2.21 1.89L7 23l5-3 5 3-2.79-6.11',
    Archive: 'M21 8v13H3V8M1 3h22v5H1V3zm9 9h4',
    Package: 'M16.5 9.4L7.5 4.21M21 16V8a2 2 0 00-1-1.73l-7-4a2 2 0 00-2 0l-7 4A2 2 0 003 8v8a2 2 0 001 1.73l7 4a2 2 0 002 0l7-4A2 2 0 0021 16zM3.27 6.96L12 12.01l8.73-5.05M12 22.08V12',
    Box: 'M21 16V8a2 2 0 00-1-1.73l-7-4a2 2 0 00-2 0l-7 4A2 2 0 003 8v8a2 2 0 001 1.73l7 4a2 2 0 002 0l7-4A2 2 0 0021 16zM3.27 6.96L12 12.01l8.73-5.05M12 22.08V12',
    Gift: 'M20 12v10H4V12m16 0H4m8 10V12m0 0V7m4 0H8a4 4 0 010-8c3 0 4 5 4 5s1-5 4-5a4 4 0 010 8z',
    Target: 'M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10zM12 18a6 6 0 100-12 6 6 0 000 12zM12 14a2 2 0 100-4 2 2 0 000 4z',
    Crosshair: 'M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10zM22 12h-4M6 12H2M12 6V2m0 20v-4',
    Eye: 'M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8zM12 15a3 3 0 100-6 3 3 0 000 6z',
    EyeOff: 'M17.94 17.94A10.07 10.07 0 0112 20c-7 0-11-8-11-8a18.45 18.45 0 015.06-5.94M9.9 4.24A9.12 9.12 0 0112 4c7 0 11 8 11 8a18.5 18.5 0 01-2.16 3.19m-6.72-1.07a3 3 0 11-4.24-4.24M1 1l22 22',
    Lock: 'M19 11H5a2 2 0 00-2 2v7a2 2 0 002 2h14a2 2 0 002-2v-7a2 2 0 00-2-2zM7 11V7a5 5 0 0110 0v4',
    Unlock: 'M19 11H5a2 2 0 00-2 2v7a2 2 0 002 2h14a2 2 0 002-2v-7a2 2 0 00-2-2zM7 11V7a5 5 0 019.9-1',
    Key: 'M21 2l-2 2m-7.61 7.61a5.5 5.5 0 11-7.778 7.778 5.5 5.5 0 017.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4',
    Shield: 'M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z',
    Sun: 'M12 17a5 5 0 100-10 5 5 0 000 10zM12 1v2m0 18v2M4.22 4.22l1.42 1.42m12.72 12.72l1.42 1.42M1 12h2m18 0h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42',
    Moon: 'M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z',
    Cloud: 'M18 10h-1.26A8 8 0 109 20h9a5 5 0 000-10z',
    Terminal: 'M4 17l6-6-6-6m8 14h8',
    Code: 'M16 18l6-6-6-6M8 6l-6 6 6 6',
    Database: 'M12 8c4.97 0 9-1.79 9-4s-4.03-4-9-4-9 1.79-9 4 4.03 4 9 4zM21 12c0 2.21-4.03 4-9 4s-9-1.79-9-4M3 4v16c0 2.21 4.03 4 9 4s9-1.79 9-4V4',
    Server: 'M20 4H4a2 2 0 00-2 2v4a2 2 0 002 2h16a2 2 0 002-2V6a2 2 0 00-2-2zM20 14H4a2 2 0 00-2 2v4a2 2 0 002 2h16a2 2 0 002-2v-4a2 2 0 00-2-2zM6 8h.01M6 18h.01',
    Cpu: 'M18 4H6a2 2 0 00-2 2v12a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2zM9 9h6v6H9V9zM9 1v3m6-3v3m-6 17v3m6-3v3m8-14h-3m3 5h-3M1 9h3m-3 5h3',
    Wifi: 'M5 12.55a11 11 0 0114.08 0M1.42 9a16 16 0 0121.16 0M8.53 16.11a6 6 0 016.95 0M12 20h.01',
    Bluetooth: 'M6.5 6.5l11 11L12 23V1l5.5 5.5-11 11',
    Power: 'M18.36 6.64a9 9 0 11-12.73 0M12 2v10',
    Battery: 'M17 6H3a2 2 0 00-2 2v8a2 2 0 002 2h14a2 2 0 002-2V8a2 2 0 00-2-2zM23 13v-2',
    Activity: 'M22 12h-4l-3 9L9 3l-3 9H2',
    BarChart: 'M12 20V10m6 10V4M6 20v-4',
    BarChart2: 'M18 20V10m-6 10V4M6 20v-6',
    PieChart: 'M21.21 15.89A10 10 0 118 2.83M22 12A10 10 0 0012 2v10z',
    TrendingUp: 'M23 6l-9.5 9.5-5-5L1 18m22-12v6h-6',
    TrendingDown: 'M23 18l-9.5-9.5-5 5L1 6m22 12v-6h-6',
    Circle: 'M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z',
    Square: 'M19 3H5a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2V5a2 2 0 00-2-2z',
    Triangle: 'M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z',
    Hexagon: 'M21 16V8a2 2 0 00-1-1.73l-7-4a2 2 0 00-2 0l-7 4A2 2 0 003 8v8a2 2 0 001 1.73l7 4a2 2 0 002 0l7-4A2 2 0 0021 16z',
    Bookmark: 'M19 21l-7-5-7 5V5a2 2 0 012-2h10a2 2 0 012 2v16z',
    Tag: 'M20.59 13.41l-7.17 7.17a2 2 0 01-2.83 0L2 12V2h10l8.59 8.59a2 2 0 010 2.82zM7 7h.01',
    Hash: 'M4 9h16M4 15h16M10 3L8 21m8-18l-2 18',
    AtSign: 'M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9',
    Percent: 'M19 5L5 19M6.5 9a2.5 2.5 0 100-5 2.5 2.5 0 000 5zm11 11a2.5 2.5 0 100-5 2.5 2.5 0 000 5z',
    DollarSign: 'M12 1v22M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6',
    CreditCard: 'M21 4H3a2 2 0 00-2 2v12a2 2 0 002 2h18a2 2 0 002-2V6a2 2 0 00-2-2zM1 10h22',
    ShoppingCart: 'M9 22a1 1 0 100-2 1 1 0 000 2zm11 0a1 1 0 100-2 1 1 0 000 2zM1 1h4l2.68 13.39a2 2 0 002 1.61h9.72a2 2 0 002-1.61L23 6H6',
    ShoppingBag: 'M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4H6zM3 6h18M16 10a4 4 0 01-8 0',
    Briefcase: 'M20 7H4a2 2 0 00-2 2v10a2 2 0 002 2h16a2 2 0 002-2V9a2 2 0 00-2-2zM16 21V5a2 2 0 00-2-2h-4a2 2 0 00-2 2v16',
    Calendar: 'M19 4H5a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2V6a2 2 0 00-2-2zM16 2v4M8 2v4M3 10h18',
    Clock: 'M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10zM12 6v6l4 2',
    Watch: 'M12 19a7 7 0 100-14 7 7 0 000 14zM12 5V3m0 18v-2m7-6.5V9m-7 .5L12 12',
    Compass: 'M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10zM16.24 7.76l-2.12 6.36-6.36 2.12 2.12-6.36 6.36-2.12z',
    MapPin: 'M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0zM12 13a3 3 0 100-6 3 3 0 000 6z',
    Navigation: 'M3 11l19-9-9 19-2-8-8-2z',
    Map: 'M1 6v16l7-4 8 4 7-4V2l-7 4-8-4-7 4zM8 2v16m8-12v16',
    Smartphone: 'M17 2H7a2 2 0 00-2 2v16a2 2 0 002 2h10a2 2 0 002-2V4a2 2 0 00-2-2zM12 18h.01',
    Tablet: 'M18 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V4a2 2 0 00-2-2zM12 18h.01',
    Laptop: 'M20 16V7a2 2 0 00-2-2H6a2 2 0 00-2 2v9m16 0H4m16 0l1.28 2.55a1 1 0 01-.9 1.45H3.62a1 1 0 01-.9-1.45L4 16',
    Tv: 'M20 7H4a2 2 0 00-2 2v10a2 2 0 002 2h16a2 2 0 002-2V9a2 2 0 00-2-2zM17 2l-5 5-5-5',
    Printer: 'M6 9V2h12v7M6 18H4a2 2 0 01-2-2v-5a2 2 0 012-2h16a2 2 0 012 2v5a2 2 0 01-2 2h-2M6 14h12v8H6v-8z',
    Headphones: 'M3 18v-6a9 9 0 0118 0v6M21 19a2 2 0 01-2 2h-1a2 2 0 01-2-2v-3a2 2 0 012-2h3zM3 19a2 2 0 002 2h1a2 2 0 002-2v-3a2 2 0 00-2-2H3z',
    Speaker: 'M18 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V4a2 2 0 00-2-2zM12 18a4 4 0 100-8 4 4 0 000 8zM12 6h.01',
    Truck: 'M1 3h15v13H1V3zm15 5h4l3 3v5h-7V8zM5.5 21a2.5 2.5 0 100-5 2.5 2.5 0 000 5zm13 0a2.5 2.5 0 100-5 2.5 2.5 0 000 5z',
    Plane: 'M17.8 19.2L16 11l3.5-3.5C21 6 21.5 4 21 3c-1-.5-3 0-4.5 1.5L13 8 4.8 6.2c-.5-.1-.9.1-1.1.5l-.3.5c-.2.5-.1 1 .3 1.3L9 12l-2 3H4l-1 1 3 2 2 3 1-1v-3l3-2 3.5 5.3c.3.4.8.5 1.3.3l.5-.2c.4-.3.6-.7.5-1.2z',
    Anchor: 'M12 8a3 3 0 100-6 3 3 0 000 6zM12 22V8m0 14c-4.418 0-8-3.134-8-7h3m5 7c4.418 0 8-3.134 8-7h-3',
    Feather: 'M20.24 12.24a6 6 0 00-8.49-8.49L5 10.5V19h8.5zM16 8L2 22m15.5-7H9',
    Aperture: 'M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10zM14.31 8l5.74 9.94M9.69 8h11.48M7.38 12l5.74-9.94M9.69 16L3.95 6.06M14.31 16H2.83M16.62 12l-5.74 9.94',
    Command: 'M18 3a3 3 0 00-3 3v12a3 3 0 003 3 3 3 0 003-3 3 3 0 00-3-3H6a3 3 0 00-3 3 3 3 0 003 3 3 3 0 003-3V6a3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3h12a3 3 0 003-3 3 3 0 00-3-3z',
    Coffee: 'M18 8h1a4 4 0 010 8h-1M2 8h16v9a4 4 0 01-4 4H6a4 4 0 01-4-4V8zm4-7v4m4-4v4m4-4v4',
    Scissors: 'M6 9a3 3 0 100-6 3 3 0 000 6zm0 12a3 3 0 100-6 3 3 0 000 6zM20 4L8.12 15.88M14.47 14.48L20 20M8.12 8.12L12 12',
    Smile: 'M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10zM8 14s1.5 2 4 2 4-2 4-2M9 9h.01M15 9h.01',
    Frown: 'M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10zM16 16s-1.5-2-4-2-4 2-4 2M9 9h.01M15 9h.01',
    Meh: 'M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10zM8 15h8M9 9h.01M15 9h.01',
    ThumbsUp: 'M14 9V5a3 3 0 00-3-3l-4 9v11h11.28a2 2 0 002-1.7l1.38-9a2 2 0 00-2-2.3H14zM7 22H4a2 2 0 01-2-2v-7a2 2 0 012-2h3',
    ThumbsDown: 'M10 15v4a3 3 0 003 3l4-9V2H5.72a2 2 0 00-2 1.7l-1.38 9a2 2 0 002 2.3H10zm7-13h2.67A2.31 2.31 0 0122 4v7a2.31 2.31 0 01-2.33 2H17',
    LogIn: 'M15 3h4a2 2 0 012 2v14a2 2 0 01-2 2h-4m-5-4l5-5-5-5m5 5H3',
    LogOut: 'M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4m7 14l5-5-5-5m5 5H9',
    Move: 'M5 9l-3 3 3 3M9 5l3-3 3 3m0 14l-3 3-3-3m14-5l3-3-3-3M2 12h20M12 2v20',
    Crop: 'M6.13 1L6 16a2 2 0 002 2h15M1 6.13L16 6a2 2 0 012 2v15',
    ZoomIn: 'M11 19a8 8 0 100-16 8 8 0 000 16zM21 21l-4.35-4.35M11 8v6m-3-3h6',
    ZoomOut: 'M11 19a8 8 0 100-16 8 8 0 000 16zM21 21l-4.35-4.35M8 11h6',
    Inbox: 'M22 12h-6l-2 3H10l-2-3H2M5.45 5.11L2 12v6a2 2 0 002 2h16a2 2 0 002-2v-6l-3.45-6.89A2 2 0 0016.76 4H7.24a2 2 0 00-1.79 1.11z',
    Paperclip: 'M21.44 11.05l-9.19 9.19a6 6 0 01-8.49-8.49l9.19-9.19a4 4 0 015.66 5.66l-9.2 9.19a2 2 0 01-2.83-2.83l8.49-8.48',
    Slash: 'M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10zM4.93 4.93l14.14 14.14',
    ToggleLeft: 'M16 5H8a7 7 0 000 14h8a7 7 0 000-14zM8 15a3 3 0 100-6 3 3 0 000 6z',
    ToggleRight: 'M16 5H8a7 7 0 100 14h8a7 7 0 100-14zM16 15a3 3 0 100-6 3 3 0 000 6z',
    Type: 'M4 7V4h16v3M9 20h6M12 4v16',
    Bold: 'M6 4h8a4 4 0 010 8H6V4zm0 8h9a4 4 0 010 8H6v-8z',
    Italic: 'M19 4h-9m4 16H5M15 4L9 20',
    Underline: 'M6 3v7a6 6 0 0012 0V3M4 21h16',
    AlignLeft: 'M17 10H3m18-4H3m18 8H3m14 4H3',
    AlignCenter: 'M18 10H6m15-4H3m18 8H3m15 4H6',
    AlignRight: 'M21 10H7m14-4H3m18 8H3m18 4H7',
    AlignJustify: 'M21 10H3m18-4H3m18 8H3m18 4H3',
    PenTool: 'M12 19l7-7 3 3-7 7-3-3zm6-11L5.5 20.5 2 22l1.5-3.5L16 6l2 2zm0 0l2.83-2.83a2 2 0 00-2.83-2.83L16 6l2 2z',
    Layers3: 'M12.83 2.18a2 2 0 00-1.66 0L2.6 6.08a1 1 0 000 1.83l8.58 3.91a2 2 0 001.66 0l8.58-3.9a1 1 0 000-1.83zM22 17.65l-9.17 4.16a2 2 0 01-1.66 0L2 17.65M22 12.65l-9.17 4.16a2 2 0 01-1.66 0L2 12.65',
    Sliders: 'M4 21v-7m0-4V3m8 18v-9m0-4V3m8 18v-5m0-4V3M1 14h6m2-6h6m2 8h6',
  };
  
  window.LucideReact = {};
  for (const [name, d] of Object.entries(icons)) {
    window.LucideReact[name] = function(props) {
      const { size = 24, color = 'currentColor', strokeWidth = 2, className = '', style = {}, ...rest } = props || {};
      return React.createElement('svg', {
        xmlns: 'http://www.w3.org/2000/svg',
        width: size,
        height: size,
        viewBox: '0 0 24 24',
        fill: 'none',
        stroke: color,
        strokeWidth: strokeWidth,
        strokeLinecap: 'round',
        strokeLinejoin: 'round',
        className: className,
        style: style,
        ...rest
      }, React.createElement('path', { d: d }));
    };
  }
  
  // Proxy to handle missing icons gracefully
  const fallbackIcon = function(props) {
    const { size = 24, color = 'currentColor', strokeWidth = 2, className = '', style = {}, ...rest } = props || {};
    // Return a simple circle as placeholder for missing icons
    return React.createElement('svg', {
      xmlns: 'http://www.w3.org/2000/svg',
      width: size,
      height: size,
      viewBox: '0 0 24 24',
      fill: 'none',
      stroke: color,
      strokeWidth: strokeWidth,
      strokeLinecap: 'round',
      strokeLinejoin: 'round',
      className: className,
      style: style,
      ...rest
    }, React.createElement('circle', { cx: 12, cy: 12, r: 10 }));
  };
  
  // Wrap LucideReact in a Proxy to catch undefined icon access
  window.LucideReact = new Proxy(window.LucideReact, {
    get(target, prop) {
      if (prop in target) {
        return target[prop];
      }
      // Log missing icon for debugging
      console.warn(`[LucideReact] Missing icon: ${String(prop)}`);
      return fallbackIcon;
    }
  });
  
  // Make icons available globally too
  window.lucide = window.LucideReact;
})();
</script>

<!-- Markdown -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/marked/9.1.6/marked.min.js"></script>

<!-- Syntax Highlighting -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

<!-- Excel/CSV -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<!-- PDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

<!-- YAML -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
:root {
  --bg: #0a0b0f;
  --bg-card: #12141a;
  --bg-hover: #1a1d25;
  --border: #252830;
  --text: #e4e6eb;
  --text-dim: #8b8f9a;
  --accent: #6366f1;
  --accent-soft: rgba(99, 102, 241, 0.15);
  --success: #10b981;
  --error: #ef4444;
  --warning: #f59e0b;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: 'Outfit', system-ui, sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
}

/* ‚îÄ‚îÄ Layout ‚îÄ‚îÄ */
.app {
  display: flex;
  flex-direction: column;
  min-height: 100vh;
}

/* ‚îÄ‚îÄ Header ‚îÄ‚îÄ */
.header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 16px 24px;
  background: var(--bg-card);
  border-bottom: 1px solid var(--border);
}

.logo {
  display: flex;
  align-items: center;
  gap: 12px;
}

.logo-icon {
  width: 40px;
  height: 40px;
  background: linear-gradient(135deg, var(--accent), #8b5cf6);
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
}

.logo-text {
  font-weight: 700;
  font-size: 18px;
  letter-spacing: -0.5px;
}

.logo-text span {
  color: var(--text-dim);
  font-weight: 400;
  font-size: 13px;
  margin-left: 8px;
}

.header-actions {
  display: flex;
  gap: 10px;
}

.btn {
  padding: 10px 18px;
  border-radius: 8px;
  border: 1px solid var(--border);
  background: var(--bg-hover);
  color: var(--text);
  font-family: inherit;
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  gap: 8px;
}

.btn:hover { background: var(--border); }

.btn-primary {
  background: var(--accent);
  border-color: var(--accent);
}
.btn-primary:hover { background: #5558e3; }

.btn-file {
  position: relative;
  overflow: hidden;
}
.btn-file input {
  position: absolute;
  inset: 0;
  opacity: 0;
  cursor: pointer;
}

.btn-build {
  background: linear-gradient(135deg, #10b981, #059669);
  border-color: #10b981;
  color: white;
  font-weight: 600;
}
.btn-build:hover {
  background: linear-gradient(135deg, #059669, #047857);
  border-color: #059669;
}

/* ‚îÄ‚îÄ Main Content ‚îÄ‚îÄ */
.main {
  flex: 1;
  display: flex;
  flex-direction: column;
}

/* ‚îÄ‚îÄ Drop Zone (Empty State) ‚îÄ‚îÄ */
.dropzone {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 48px;
  border: 2px dashed var(--border);
  border-radius: 16px;
  margin: 24px;
  transition: all 0.3s;
  cursor: pointer;
}

.dropzone.dragover {
  border-color: var(--accent);
  background: var(--accent-soft);
}

.dropzone-icon {
  width: 80px;
  height: 80px;
  background: var(--bg-hover);
  border-radius: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 36px;
  margin-bottom: 20px;
}

.dropzone-title {
  font-size: 20px;
  font-weight: 600;
  margin-bottom: 8px;
}

.dropzone-hint {
  color: var(--text-dim);
  font-size: 14px;
  text-align: center;
  line-height: 1.6;
}

.supported-formats {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-top: 20px;
  justify-content: center;
}

.format-tag {
  padding: 4px 10px;
  background: var(--bg-hover);
  border-radius: 6px;
  font-size: 11px;
  font-weight: 500;
  color: var(--text-dim);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* ‚îÄ‚îÄ Preview Container ‚îÄ‚îÄ */
.preview-container {
  flex: 1;
  display: none;
  flex-direction: column;
  margin: 16px;
  background: var(--bg-card);
  border-radius: 12px;
  border: 1px solid var(--border);
  overflow: hidden;
}

.preview-container.active { display: flex; }

/* ‚îÄ‚îÄ File Info Bar ‚îÄ‚îÄ */
.file-bar {
  display: flex;
  align-items: center;
  padding: 12px 16px;
  background: var(--bg-hover);
  border-bottom: 1px solid var(--border);
  gap: 12px;
}

.file-icon {
  font-size: 20px;
}

.file-name {
  font-weight: 500;
  font-size: 14px;
  flex: 1;
}

.file-meta {
  display: flex;
  gap: 16px;
  color: var(--text-dim);
  font-size: 12px;
}

.file-meta span {
  display: flex;
  align-items: center;
  gap: 4px;
}

.file-close {
  background: none;
  border: none;
  color: var(--text-dim);
  font-size: 18px;
  cursor: pointer;
  padding: 4px 8px;
  border-radius: 4px;
  transition: all 0.2s;
}
.file-close:hover {
  background: var(--border);
  color: var(--error);
}

/* ‚îÄ‚îÄ Preview Toolbar ‚îÄ‚îÄ */
.preview-toolbar {
  display: flex;
  align-items: center;
  padding: 8px 16px;
  border-bottom: 1px solid var(--border);
  gap: 8px;
  flex-wrap: wrap;
}

.toolbar-group {
  display: flex;
  align-items: center;
  gap: 4px;
}

.toolbar-btn {
  padding: 6px 12px;
  border-radius: 6px;
  border: none;
  background: transparent;
  color: var(--text-dim);
  font-family: inherit;
  font-size: 12px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.15s;
}

.toolbar-btn:hover { background: var(--bg-hover); color: var(--text); }
.toolbar-btn.active { background: var(--accent-soft); color: var(--accent); }

.toolbar-divider {
  width: 1px;
  height: 20px;
  background: var(--border);
  margin: 0 8px;
}

/* ‚îÄ‚îÄ Preview Area ‚îÄ‚îÄ */
.preview-area {
  flex: 1;
  overflow: auto;
  position: relative;
}

/* ‚îÄ‚îÄ Specific Preview Styles ‚îÄ‚îÄ */

/* Code/Text */
.preview-code {
  padding: 16px;
  font-family: 'JetBrains Mono', monospace;
  font-size: 13px;
  line-height: 1.6;
  white-space: pre-wrap;
  word-break: break-all;
}

.preview-code code {
  background: transparent !important;
  padding: 0 !important;
}

/* HTML/JSX Render */
.preview-render {
  width: 100%;
  height: 100%;
  background: #fff;
}

.preview-render.dark-bg { background: #1a1a2e; }
.preview-render.transparent-bg {
  background: repeating-conic-gradient(#e5e7eb 0% 25%, transparent 0% 50%) 0 0 / 16px 16px;
}

#render-root {
  width: 100%;
  min-height: 100%;
  padding: 20px;
}

/* JSON Tree */
.json-tree {
  padding: 16px;
  font-family: 'JetBrains Mono', monospace;
  font-size: 13px;
  line-height: 1.8;
}

.json-key { color: #7dd3fc; }
.json-string { color: #86efac; }
.json-number { color: #fcd34d; }
.json-boolean { color: #c4b5fd; }
.json-null { color: #9ca3af; }

.json-toggle {
  cursor: pointer;
  user-select: none;
  display: inline-block;
  width: 16px;
  text-align: center;
  color: var(--text-dim);
}
.json-toggle:hover { color: var(--accent); }

.json-collapsed { display: none; }
.json-bracket { color: var(--text-dim); }
.json-comma { color: var(--text-dim); }

/* Table (CSV/Excel/JSON Array) */
.preview-table-wrap {
  padding: 16px;
  overflow: auto;
}

.preview-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 13px;
}

.preview-table th,
.preview-table td {
  padding: 10px 14px;
  text-align: left;
  border: 1px solid var(--border);
  max-width: 300px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.preview-table th {
  background: var(--bg-hover);
  font-weight: 600;
  position: sticky;
  top: 0;
}

.preview-table tr:hover td {
  background: var(--bg-hover);
}

/* Markdown */
.preview-markdown {
  padding: 32px 48px;
  max-width: 800px;
  margin: 0 auto;
  line-height: 1.8;
}

.preview-markdown h1, .preview-markdown h2, .preview-markdown h3 {
  margin-top: 1.5em;
  margin-bottom: 0.5em;
  font-weight: 600;
}

.preview-markdown h1 { font-size: 2em; border-bottom: 1px solid var(--border); padding-bottom: 0.3em; }
.preview-markdown h2 { font-size: 1.5em; }
.preview-markdown h3 { font-size: 1.25em; }

.preview-markdown p { margin: 1em 0; }
.preview-markdown a { color: var(--accent); }
.preview-markdown code {
  background: var(--bg-hover);
  padding: 2px 6px;
  border-radius: 4px;
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.9em;
}
.preview-markdown pre {
  background: var(--bg);
  padding: 16px;
  border-radius: 8px;
  overflow-x: auto;
  margin: 1em 0;
}
.preview-markdown pre code {
  background: none;
  padding: 0;
}
.preview-markdown blockquote {
  border-left: 4px solid var(--accent);
  padding-left: 16px;
  margin: 1em 0;
  color: var(--text-dim);
}
.preview-markdown ul, .preview-markdown ol { padding-left: 24px; margin: 1em 0; }
.preview-markdown li { margin: 0.5em 0; }
.preview-markdown img { max-width: 100%; border-radius: 8px; }
.preview-markdown table { border-collapse: collapse; margin: 1em 0; }
.preview-markdown th, .preview-markdown td { border: 1px solid var(--border); padding: 8px 12px; }
.preview-markdown th { background: var(--bg-hover); }

/* Image */
.preview-image {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 24px;
  min-height: 100%;
}

.preview-image img {
  max-width: 100%;
  max-height: calc(100vh - 200px);
  border-radius: 8px;
  box-shadow: 0 4px 24px rgba(0,0,0,0.3);
}

.preview-image.tiled {
  background: repeating-conic-gradient(#e5e7eb 0% 25%, #fff 0% 50%) 0 0 / 16px 16px;
}

/* PDF */
.preview-pdf {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 16px;
  gap: 16px;
  background: #525659;
}

.pdf-page {
  box-shadow: 0 4px 16px rgba(0,0,0,0.3);
}

/* Error */
.preview-error {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 48px;
  text-align: center;
}

.preview-error .error-icon {
  font-size: 48px;
  margin-bottom: 16px;
}

.preview-error .error-title {
  font-size: 18px;
  font-weight: 600;
  margin-bottom: 8px;
}

.preview-error .error-message {
  color: var(--text-dim);
  font-size: 14px;
  max-width: 400px;
}

/* ‚îÄ‚îÄ Toast ‚îÄ‚îÄ */
.toast {
  position: fixed;
  bottom: 24px;
  left: 50%;
  transform: translateX(-50%) translateY(100px);
  background: var(--bg-card);
  border: 1px solid var(--border);
  padding: 12px 24px;
  border-radius: 10px;
  font-size: 14px;
  font-weight: 500;
  box-shadow: 0 8px 32px rgba(0,0,0,0.3);
  opacity: 0;
  transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
  z-index: 1000;
}

.toast.show {
  opacity: 1;
  transform: translateX(-50%) translateY(0);
}

.toast.success { border-color: var(--success); }
.toast.error { border-color: var(--error); }

/* ‚îÄ‚îÄ Loading ‚îÄ‚îÄ */
.loading {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 48px;
  gap: 16px;
}

.spinner {
  width: 40px;
  height: 40px;
  border: 3px solid var(--border);
  border-top-color: var(--accent);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin { to { transform: rotate(360deg); } }

/* ‚îÄ‚îÄ Responsive ‚îÄ‚îÄ */
@media (max-width: 768px) {
  .header { padding: 12px 16px; }
  .preview-container { margin: 8px; }
  .preview-markdown { padding: 20px; }
  .editor-mode { flex-direction: column; }
  .editor-panel, .editor-preview-panel { width: 100% !important; height: 50%; }
}

/* ‚îÄ‚îÄ Editor Mode ‚îÄ‚îÄ */
.editor-mode {
  display: none;
  flex: 1;
  flex-direction: row;
}

.editor-mode.active { display: flex; }

.editor-panel {
  width: 50%;
  display: flex;
  flex-direction: column;
  background: var(--bg-card);
  border-right: 1px solid var(--border);
}

.editor-header {
  display: flex;
  align-items: center;
  padding: 10px 16px;
  background: var(--bg-hover);
  border-bottom: 1px solid var(--border);
  gap: 12px;
}

.editor-header select {
  padding: 6px 12px;
  border-radius: 6px;
  border: 1px solid var(--border);
  background: var(--bg);
  color: var(--text);
  font-family: inherit;
  font-size: 13px;
  cursor: pointer;
}

.editor-header select:focus {
  outline: none;
  border-color: var(--accent);
}

.editor-header .editor-title {
  font-weight: 500;
  font-size: 13px;
  color: var(--text-dim);
}

.editor-header .run-btn {
  margin-left: auto;
  padding: 6px 16px;
  background: var(--accent);
  border: none;
  border-radius: 6px;
  color: #fff;
  font-family: inherit;
  font-size: 13px;
  font-weight: 500;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 6px;
  transition: background 0.2s;
}

.editor-header .run-btn:hover { background: #5558e3; }

.detected-type {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 6px 14px;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 8px;
  font-size: 13px;
  transition: all 0.3s;
}

.detected-type.jsx { border-color: #61dafb; background: rgba(97, 218, 251, 0.1); }
.detected-type.html { border-color: #e34c26; background: rgba(227, 76, 38, 0.1); }
.detected-type.markdown { border-color: #083fa1; background: rgba(8, 63, 161, 0.1); }
.detected-type.svg { border-color: #ffb13b; background: rgba(255, 177, 59, 0.1); }
.detected-type.json { border-color: #f5a623; background: rgba(245, 166, 35, 0.1); }
.detected-type.css { border-color: #264de4; background: rgba(38, 77, 228, 0.1); }
.detected-type.yaml { border-color: #cb171e; background: rgba(203, 23, 30, 0.1); }
.detected-type.text { border-color: var(--border); }

.detected-icon {
  font-size: 16px;
}

.detected-label {
  font-weight: 500;
  color: var(--text);
}

.editor-textarea {
  flex: 1;
  width: 100%;
  padding: 16px;
  background: var(--bg);
  border: none;
  color: var(--text);
  font-family: 'JetBrains Mono', monospace;
  font-size: 13px;
  line-height: 1.6;
  resize: none;
  outline: none;
  tab-size: 2;
}

.editor-textarea::placeholder {
  color: var(--text-dim);
}

.editor-preview-panel {
  width: 50%;
  display: flex;
  flex-direction: column;
  background: var(--bg);
}

.editor-preview-header {
  display: flex;
  align-items: center;
  padding: 10px 16px;
  background: var(--bg-hover);
  border-bottom: 1px solid var(--border);
  gap: 8px;
}

.editor-preview-header .preview-title {
  font-weight: 500;
  font-size: 13px;
  color: var(--text-dim);
}

.preview-bg-toggle {
  margin-left: auto;
  display: flex;
  gap: 4px;
}

.preview-bg-toggle button {
  padding: 4px 10px;
  border: none;
  background: transparent;
  color: var(--text-dim);
  font-family: inherit;
  font-size: 11px;
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.15s;
}

.preview-bg-toggle button:hover { color: var(--text); }
.preview-bg-toggle button.active { background: var(--accent-soft); color: var(--accent); }

.editor-preview-area {
  flex: 1;
  overflow: auto;
  background: #fff;
}

.editor-preview-area.dark-bg { background: #1a1a2e; }
.editor-preview-area.transparent-bg {
  background: repeating-conic-gradient(#e5e7eb 0% 25%, transparent 0% 50%) 0 0 / 16px 16px;
}

.editor-preview-area iframe {
  width: 100%;
  height: 100%;
  border: none;
}

#editor-render-root {
  padding: 20px;
  min-height: 100%;
}

.editor-error {
  padding: 16px;
  background: rgba(239, 68, 68, 0.1);
  border-top: 1px solid rgba(239, 68, 68, 0.3);
  color: var(--error);
  font-family: 'JetBrains Mono', monospace;
  font-size: 12px;
  white-space: pre-wrap;
  max-height: 150px;
  overflow: auto;
}

/* Console panel */
.editor-console {
  border-top: 1px solid var(--border);
  background: #1a1a2e;
  max-height: 200px;
  display: flex;
  flex-direction: column;
}
.console-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 12px;
  background: #252540;
  color: #888;
  font-size: 12px;
  font-weight: 600;
  border-bottom: 1px solid rgba(255,255,255,0.1);
}
.console-actions {
  display: flex;
  gap: 8px;
}
.console-copy-btn, .console-clear-btn {
  background: transparent;
  border: 1px solid rgba(255,255,255,0.2);
  color: #aaa;
  padding: 4px 8px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 11px;
  transition: all 0.2s;
}
.console-copy-btn:hover, .console-clear-btn:hover {
  background: rgba(255,255,255,0.1);
  color: #fff;
}
.console-copy-btn.copied {
  background: var(--success);
  color: white;
  border-color: var(--success);
}
.console-messages {
  flex: 1;
  overflow: auto;
  padding: 8px;
  font-family: 'JetBrains Mono', monospace;
  font-size: 11px;
  line-height: 1.6;
}
.console-msg {
  padding: 4px 8px;
  border-radius: 4px;
  margin-bottom: 4px;
  word-break: break-all;
}
.console-msg.log { color: #e0e0e0; background: rgba(255,255,255,0.05); }
.console-msg.warn { color: #f59e0b; background: rgba(245, 158, 11, 0.1); }
.console-msg.error { color: #ef4444; background: rgba(239, 68, 68, 0.1); }
.console-msg.info { color: #3b82f6; background: rgba(59, 130, 246, 0.1); }
.console-msg.explain { 
  color: #34d399; 
  background: rgba(52, 211, 153, 0.1); 
  border-left: 3px solid #34d399;
  margin-left: 12px;
  font-size: 11px;
  white-space: pre-wrap;
  line-height: 1.8;
}

/* Resize handle */
.editor-resize-handle {
  width: 4px;
  background: var(--border);
  cursor: col-resize;
  transition: background 0.2s;
  flex-shrink: 0;
}

.editor-resize-handle:hover,
.editor-resize-handle.active {
  background: var(--accent);
}
</style>
</head>
<body>

<div class="app">
  <header class="header">
    <div class="logo">
      <div class="logo-icon">üìÅ</div>
      <div class="logo-text">Universal Previewer<span>v2.0</span></div>
    </div>
    <div class="header-actions">
      <button class="btn" id="newFileBtn">‚ú® Êñ∞Ë¶è‰ΩúÊàê</button>
      <label class="btn btn-file">
        üìÇ „Éï„Ç°„Ç§„É´„ÇíÈñã„Åè
        <input type="file" id="fileInput" multiple>
      </label>
      <button class="btn" id="downloadBtn" style="display:none;">üíæ HTML„Åß‰øùÂ≠ò</button>
      <button class="btn btn-build" id="buildDownloadBtn" style="display:none;">‚ö° „Éì„É´„ÉâÊ∏à„ÅøHTML„Åß‰øùÂ≠ò</button>
      <button class="btn" id="clearBtn" style="display:none;">‚úï Èñâ„Åò„Çã</button>
    </div>
  </header>

  <main class="main">
    <!-- Empty State / Drop Zone -->
    <div class="dropzone" id="dropzone">
      <div class="dropzone-icon">üìÑ</div>
      <div class="dropzone-title">„Éï„Ç°„Ç§„É´„Çí„Éâ„É≠„ÉÉ„Éó„Åó„Å¶„Éó„É¨„Éì„É•„Éº</div>
      <div class="dropzone-hint">
        „ÇØ„É™„ÉÉ„ÇØ„Åæ„Åü„ÅØ„Éâ„É©„ÉÉ„Ç∞&„Éâ„É≠„ÉÉ„Éó„Åß„Éï„Ç°„Ç§„É´„ÇíÈñã„Åè
      </div>
      <div class="supported-formats">
        <span class="format-tag">JSX</span>
        <span class="format-tag">TSX</span>
        <span class="format-tag">HTML</span>
        <span class="format-tag">CSS</span>
        <span class="format-tag">JSON</span>
        <span class="format-tag">YAML</span>
        <span class="format-tag">MD</span>
        <span class="format-tag">CSV</span>
        <span class="format-tag">XLSX</span>
        <span class="format-tag">PNG</span>
        <span class="format-tag">JPG</span>
        <span class="format-tag">SVG</span>
        <span class="format-tag">GIF</span>
        <span class="format-tag">PDF</span>
        <span class="format-tag">TXT</span>
        <span class="format-tag">JS</span>
        <span class="format-tag">TS</span>
        <span class="format-tag">PY</span>
        <span class="format-tag">...</span>
      </div>
    </div>

    <!-- Preview Container -->
    <div class="preview-container" id="previewContainer">
      <div class="file-bar">
        <span class="file-icon" id="fileIcon">üìÑ</span>
        <span class="file-name" id="fileName">filename.ext</span>
        <div class="file-meta">
          <span id="fileSize">0 KB</span>
          <span id="fileType">TYPE</span>
        </div>
        <button class="file-close" id="closePreview">‚úï</button>
      </div>
      <div class="preview-toolbar" id="previewToolbar"></div>
      <div class="preview-area" id="previewArea"></div>
    </div>

    <!-- Editor Mode -->
    <div class="editor-mode" id="editorMode">
      <div class="editor-panel" id="editorPanel">
        <div class="editor-header">
          <span class="editor-title">üìù „Ç®„Éá„Ç£„Çø</span>
          <div class="detected-type" id="detectedType">
            <span class="detected-icon">üîç</span>
            <span class="detected-label">Ëá™ÂãïÂà§Âà•‰∏≠...</span>
          </div>
          <button class="run-btn" id="runBtn">‚ñ∂ ÂÆüË°å</button>
        </div>
        <textarea class="editor-textarea" id="editorTextarea" placeholder="„Ç≥„Éº„Éâ„ÇíÂÖ•Âäõ..." spellcheck="false"></textarea>
        <div class="editor-error" id="editorError" style="display:none;"></div>
        <div class="editor-console" id="editorConsole">
          <div class="console-header">
            <span>üìã Console</span>
            <div class="console-actions">
              <button class="console-copy-btn" id="consoleCopyBtn" title="„Ç≥„Éî„Éº">üìã „Ç≥„Éî„Éº</button>
              <button class="console-clear-btn" id="consoleClearBtn" title="„ÇØ„É™„Ç¢">üóëÔ∏è</button>
            </div>
          </div>
          <div class="console-messages" id="consoleMessages"></div>
        </div>
      </div>
      <div class="editor-resize-handle" id="editorResizeHandle"></div>
      <div class="editor-preview-panel" id="editorPreviewPanel">
        <div class="editor-preview-header">
          <span class="preview-title">üëÅÔ∏è „Éó„É¨„Éì„É•„Éº</span>
          <div class="preview-bg-toggle">
            <button data-bg="light" class="active">Light</button>
            <button data-bg="dark">Dark</button>
            <button data-bg="transparent">ÈÄèÈÅé</button>
          </div>
        </div>
        <div class="editor-preview-area" id="editorPreviewArea">
          <div id="editor-render-root"></div>
        </div>
      </div>
    </div>
  </main>
</div>

<div class="toast" id="toast"></div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// Universal File Previewer
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const $ = id => document.getElementById(id);

const dropzone = $('dropzone');
const previewContainer = $('previewContainer');
const previewArea = $('previewArea');
const previewToolbar = $('previewToolbar');
const fileInput = $('fileInput');
const clearBtn = $('clearBtn');
const closePreview = $('closePreview');
const toast = $('toast');

// Editor mode elements
const editorMode = $('editorMode');
const editorPanel = $('editorPanel');
const editorPreviewPanel = $('editorPreviewPanel');
const editorTextarea = $('editorTextarea');
const detectedTypeEl = $('detectedType');
const editorPreviewArea = $('editorPreviewArea');
const editorError = $('editorError');
const consoleMessages = $('consoleMessages');
const consoleCopyBtn = $('consoleCopyBtn');
const consoleClearBtn = $('consoleClearBtn');

// Console log capture
const consoleLogs = [];
const originalConsole = {
  log: console.log,
  warn: console.warn,
  error: console.error,
  info: console.info
};

// „Ç®„É©„Éº„É°„ÉÉ„Çª„Éº„Ç∏„ÅÆÊó•Êú¨Ë™ûËß£Ë™¨ËæûÊõ∏
const errorExplanations = [
  // ReactÈñ¢ÈÄ£
  { pattern: /is not defined/i, explain: (m) => {
    const varName = m.match(/(\w+)\s+is not defined/i)?.[1];
    return `üí° Ëß£Ë™¨: „Äå${varName || 'Â§âÊï∞'}„Äç„ÅåÂÆöÁæ©„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ\n   ‚Üí import„ÅßË™≠„ÅøËæº„ÇÄ„Åã„ÄÅconst/let/var„ÅßÂÆ£Ë®Ä„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`;
  }},
  { pattern: /is not a function/i, explain: (m) => {
    const funcName = m.match(/(\w+)\s+is not a function/i)?.[1];
    return `üí° Ëß£Ë™¨: „Äå${funcName || 'ÂØæË±°'}„Äç„ÅØÈñ¢Êï∞„Åß„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ\n   ‚Üí Èñ¢Êï∞„Å®„Åó„Å¶Ê≠£„Åó„ÅèÂÆöÁæ©„Åï„Çå„Å¶„ÅÑ„Çã„ÅãÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`;
  }},
  { pattern: /Cannot read propert(y|ies) of (undefined|null)/i, explain: () => 
    `üí° Ëß£Ë™¨: undefined „Åæ„Åü„ÅØ null „ÅÆ„Éó„É≠„Éë„ÉÜ„Ç£„Å´„Ç¢„ÇØ„Çª„Çπ„Åó„Çà„ÅÜ„Å®„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ\n   ‚Üí „Ç™„Éó„Ç∑„Éß„Éä„É´„ÉÅ„Çß„Éº„É≥(?.)„Çí‰Ωø„ÅÜ„Åã„ÄÅÂÄ§„ÅÆÂ≠òÂú®Á¢∫Ë™ç„Çí„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`
  },
  { pattern: /Invalid hook call/i, explain: () => 
    `üí° Ëß£Ë™¨: „Éï„ÉÉ„ÇØ„ÅÆÂëº„Å≥Âá∫„Åó„Åå‰∏çÊ≠£„Åß„Åô„ÄÇ\n   ‚Üí „Éï„ÉÉ„ÇØ„ÅØ„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà„ÅÆ„Éà„ÉÉ„Éó„É¨„Éô„É´„Åß„ÅÆ„Åø‰ΩøÁî®„Åß„Åç„Åæ„Åô„ÄÇ\n   ‚Üí Êù°‰ª∂ÂàÜÂ≤ê„ÇÑ„É´„Éº„Éó„ÅÆ‰∏≠„Åß„ÅØ‰Ωø„Åà„Åæ„Åõ„Çì„ÄÇ`
  },
  { pattern: /Rendered more hooks than/i, explain: () => 
    `üí° Ëß£Ë™¨: ÂâçÂõû„ÅÆ„É¨„É≥„ÉÄ„É™„É≥„Ç∞„Çà„ÇäÂ§ö„Åè„ÅÆ„Éï„ÉÉ„ÇØ„ÅåÂëº„Å∞„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ\n   ‚Üí „Éï„ÉÉ„ÇØ„ÅØÂ∏∏„Å´Âêå„ÅòÈ†ÜÂ∫è„ÉªÂõûÊï∞„ÅßÂëº„Å≥Âá∫„ÅôÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ`
  },
  { pattern: /Too many re-renders/i, explain: () => 
    `üí° Ëß£Ë™¨: ÁÑ°Èôê„É´„Éº„Éó„ÅåÁô∫Áîü„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ\n   ‚Üí useEffect„ÅÆ‰æùÂ≠òÈÖçÂàó„ÇÑ„ÄÅsetStateÂëº„Å≥Âá∫„Åó„ÅÆÊù°‰ª∂„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`
  },
  { pattern: /Each child in a list should have a unique "key"/i, explain: () => 
    `üí° Ëß£Ë™¨: „É™„Çπ„Éà„ÅÆÂêÑË¶ÅÁ¥†„Å´„É¶„Éã„Éº„ÇØ„Å™key„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ\n   ‚Üí map()ÂÜÖ„ÅÆJSXË¶ÅÁ¥†„Å´keyÂ±ûÊÄß„ÇíËøΩÂä†„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ\n   ‚Üí ‰æã: <li key={item.id}>{item.name}</li>`
  },
  { pattern: /Objects are not valid as a React child/i, explain: () => 
    `üí° Ëß£Ë™¨: „Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„Çí„Åù„ÅÆ„Åæ„ÅæJSX„Å´Ë°®Á§∫„Åó„Çà„ÅÜ„Å®„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ\n   ‚Üí JSON.stringify()„ÅßÊñáÂ≠óÂàóÂåñ„Åô„Çã„Åã„ÄÅ„Éó„É≠„Éë„ÉÜ„Ç£„ÇíÂÄãÂà•„Å´Ë°®Á§∫„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`
  },
  
  // Babel/ÊßãÊñá„Ç®„É©„Éº
  { pattern: /Unexpected token/i, explain: (m) => {
    const token = m.match(/Unexpected token[:\s]*['"]?(\S+)['"]?/i)?.[1];
    return `üí° Ëß£Ë™¨: ‰∫àÊúü„Åó„Å™„ÅÑÊñáÂ≠ó„Äå${token || '?'}„Äç„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åó„Åü„ÄÇ\n   ‚Üí „Ç´„ÉÉ„Ç≥„ÅÆÂØæÂøú„ÄÅ„Çª„Éü„Ç≥„É≠„É≥„ÄÅ„Ç´„É≥„Éû„ÅÆÈÅé‰∏çË∂≥„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`;
  }},
  { pattern: /Unterminated string/i, explain: () => 
    `üí° Ëß£Ë™¨: ÊñáÂ≠óÂàó„ÅåÈñâ„Åò„Çâ„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ\n   ‚Üí „ÇØ„Ç©„Éº„Éà(' „Åæ„Åü„ÅØ ")„ÅÆÂØæÂøú„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`
  },
  { pattern: /Missing semicolon/i, explain: () => 
    `üí° Ëß£Ë™¨: „Çª„Éü„Ç≥„É≠„É≥„Åå‰∏çË∂≥„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ\n   ‚Üí Êñá„ÅÆÁµÇ„Çè„Çä„Å´„Çª„Éü„Ç≥„É≠„É≥„ÇíËøΩÂä†„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`
  },
  { pattern: /Adjacent JSX elements must be wrapped/i, explain: () => 
    `üí° Ëß£Ë™¨: Ë§áÊï∞„ÅÆJSXË¶ÅÁ¥†„ÅØ1„Å§„ÅÆË¶™Ë¶ÅÁ¥†„ÅßÂõ≤„ÇÄÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ\n   ‚Üí <div>...</div> „Åæ„Åü„ÅØ <>...</> „ÅßÂõ≤„Çì„Åß„Åè„Å†„Åï„ÅÑ„ÄÇ`
  },
  { pattern: /Unexpected end of input/i, explain: () => 
    `üí° Ëß£Ë™¨: „Ç≥„Éº„Éâ„ÅåÈÄî‰∏≠„ÅßÁµÇ„Çè„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ\n   ‚Üí „Ç´„ÉÉ„Ç≥ {} () [] „ÅÆÈñâ„ÅòÂøò„Çå„Åå„Å™„ÅÑ„ÅãÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`
  },
  
  // „É¢„Ç∏„É•„Éº„É´Èñ¢ÈÄ£
  { pattern: /Cannot find module/i, explain: (m) => {
    const mod = m.match(/Cannot find module\s+['"]([^'"]+)['"]/i)?.[1];
    return `üí° Ëß£Ë™¨: „É¢„Ç∏„É•„Éº„É´„Äå${mod || '?'}„Äç„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„ÄÇ\n   ‚Üí „Åì„ÅÆ„Éó„É¨„Éì„É•„Éº„Ç¢„Åß„ÅØÂ§ñÈÉ®„É©„Ç§„Éñ„É©„É™„ÅØÈôêÂÆöÁöÑ„Å´„Çµ„Éù„Éº„Éà„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ\n   ‚Üí lucide-react, recharts „Å™„Å©„ÅØ‰ΩøÁî®ÂèØËÉΩ„Åß„Åô„ÄÇ`;
  }},
  { pattern: /\[LucideReact\] Missing/i, explain: (m) => {
    const icon = m.match(/Missing:\s*(\w+)/i)?.[1];
    return `üí° Ëß£Ë™¨: „Ç¢„Ç§„Ç≥„É≥„Äå${icon || '?'}„Äç„ÅØÂÜÖËîµ„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ\n   ‚Üí ‰ª£„Çè„Çä„Å´ ‚óã „Ç¢„Ç§„Ç≥„É≥„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô„ÄÇ\n   ‚Üí „Çà„Åè‰Ωø„ÅÜ„Ç¢„Ç§„Ç≥„É≥„ÅØÂØæÂøú„Åó„Å¶„ÅÑ„Åæ„Åô„Åå„ÄÅ‰∏ÄÈÉ®Êú™ÂØæÂøú„ÅÆ„ÇÇ„ÅÆ„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ`;
  }},
  
  // Âûã„ÉªÂÄ§„Ç®„É©„Éº
  { pattern: /TypeError/i, explain: () => 
    `üí° Ëß£Ë™¨: Âûã„Ç®„É©„Éº„Åß„Åô„ÄÇ\n   ‚Üí ÊúüÂæÖ„Åï„Çå„ÇãÂûã„Å®ÂÆüÈöõ„ÅÆÂÄ§„ÅÆÂûã„Åå‰∏ÄËá¥„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ`
  },
  { pattern: /ReferenceError/i, explain: () => 
    `üí° Ëß£Ë™¨: ÂèÇÁÖß„Ç®„É©„Éº„Åß„Åô„ÄÇ\n   ‚Üí Â≠òÂú®„Åó„Å™„ÅÑÂ§âÊï∞„ÇÑÈñ¢Êï∞„ÇíÂèÇÁÖß„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ`
  },
  { pattern: /SyntaxError/i, explain: () => 
    `üí° Ëß£Ë™¨: ÊßãÊñá„Ç®„É©„Éº„Åß„Åô„ÄÇ\n   ‚Üí „Ç≥„Éº„Éâ„ÅÆÊõ∏„ÅçÊñπ„Å´Ë™§„Çä„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ„Ç´„ÉÉ„Ç≥„ÇÑË®òÂè∑„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`
  },
  { pattern: /RangeError/i, explain: () => 
    `üí° Ëß£Ë™¨: ÁØÑÂõ≤„Ç®„É©„Éº„Åß„Åô„ÄÇ\n   ‚Üí ÈÖçÂàó„ÅÆ„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ„ÇÑÊï∞ÂÄ§„ÅåÊúâÂäπÁØÑÂõ≤Â§ñ„Åß„Åô„ÄÇ`
  },
  
  // APIÈñ¢ÈÄ£
  { pattern: /fetch.*failed|NetworkError|Failed to fetch/i, explain: () => 
    `üí° Ëß£Ë™¨: „Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„Ç®„É©„Éº„Åß„Åô„ÄÇ\n   ‚Üí API„ÅÆURL„ÅåÊ≠£„Åó„ÅÑ„ÅãÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ\n   ‚Üí CORS„ÅÆÂà∂Èôê„ÇÑ„Ç§„É≥„Çø„Éº„Éç„ÉÉ„ÉàÊé•Á∂ö„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`
  },
  { pattern: /API.*key|apiKey|API_KEY/i, explain: () => 
    `üí° Ëß£Ë™¨: API„Ç≠„Éº„Å´Èñ¢„Åô„Çã„Ç®„É©„Éº„Åß„Åô„ÄÇ\n   ‚Üí API„Ç≠„Éº„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Çã„ÅãÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ\n   ‚Üí „Åì„ÅÆ„Éó„É¨„Éì„É•„ÉºÁí∞Â¢É„Åß„ÅØAPI„Ç≠„Éº„ÅØÁ©∫„Å´„Å™„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ`
  },
];

function getErrorExplanation(message) {
  for (const { pattern, explain } of errorExplanations) {
    if (pattern.test(message)) {
      return explain(message);
    }
  }
  return null;
}

function addConsoleMessage(type, args) {
  const msg = Array.from(args).map(a => 
    typeof a === 'object' ? JSON.stringify(a, null, 2) : String(a)
  ).join(' ');
  
  consoleLogs.push({ type, msg, time: new Date() });
  
  if (consoleMessages) {
    const el = document.createElement('div');
    el.className = `console-msg ${type}`;
    el.textContent = msg;
    consoleMessages.appendChild(el);
    
    // „Ç®„É©„Éº„ÇÑË≠¶Âëä„ÅÆÂ†¥Âêà„ÅØÊó•Êú¨Ë™ûËß£Ë™¨„ÇíËøΩÂä†
    if (type === 'error' || type === 'warn') {
      const explanation = getErrorExplanation(msg);
      if (explanation) {
        const explainEl = document.createElement('div');
        explainEl.className = 'console-msg explain';
        explainEl.textContent = explanation;
        consoleMessages.appendChild(explainEl);
        consoleLogs.push({ type: 'explain', msg: explanation, time: new Date() });
      }
    }
    
    consoleMessages.scrollTop = consoleMessages.scrollHeight;
  }
}

// Override console methods
console.log = function(...args) {
  originalConsole.log.apply(console, args);
  addConsoleMessage('log', args);
};
console.warn = function(...args) {
  originalConsole.warn.apply(console, args);
  addConsoleMessage('warn', args);
};
console.error = function(...args) {
  originalConsole.error.apply(console, args);
  addConsoleMessage('error', args);
};
console.info = function(...args) {
  originalConsole.info.apply(console, args);
  addConsoleMessage('info', args);
};

// Console copy button
if (consoleCopyBtn) {
  consoleCopyBtn.addEventListener('click', () => {
    const text = consoleLogs.map(l => `[${l.type.toUpperCase()}] ${l.msg}`).join('\n');
    navigator.clipboard.writeText(text).then(() => {
      consoleCopyBtn.classList.add('copied');
      consoleCopyBtn.textContent = '‚úì „Ç≥„Éî„ÉºÂÆå‰∫Ü';
      setTimeout(() => {
        consoleCopyBtn.classList.remove('copied');
        consoleCopyBtn.textContent = 'üìã „Ç≥„Éî„Éº';
      }, 2000);
    });
  });
}

// Console clear button
if (consoleClearBtn) {
  consoleClearBtn.addEventListener('click', () => {
    consoleLogs.length = 0;
    if (consoleMessages) consoleMessages.innerHTML = '';
  });
}

const newFileBtn = $('newFileBtn');
const downloadBtn = $('downloadBtn');
const buildDownloadBtn = $('buildDownloadBtn');
const runBtn = $('runBtn');
const editorResizeHandle = $('editorResizeHandle');

// Current detected type
let currentEditorType = 'text';

// File type detection
const FILE_TYPES = {
  // React/JSX
  jsx: { type: 'jsx', icon: '‚öõÔ∏è', label: 'React JSX' },
  tsx: { type: 'jsx', icon: '‚öõÔ∏è', label: 'React TSX' },
  
  // HTML/CSS
  html: { type: 'html', icon: 'üåê', label: 'HTML' },
  htm: { type: 'html', icon: 'üåê', label: 'HTML' },
  css: { type: 'code', icon: 'üé®', label: 'CSS', lang: 'css' },
  
  // Data formats
  json: { type: 'json', icon: 'üìã', label: 'JSON' },
  yaml: { type: 'yaml', icon: 'üìã', label: 'YAML' },
  yml: { type: 'yaml', icon: 'üìã', label: 'YAML' },
  
  // Markdown
  md: { type: 'markdown', icon: 'üìù', label: 'Markdown' },
  markdown: { type: 'markdown', icon: 'üìù', label: 'Markdown' },
  
  // Spreadsheet
  csv: { type: 'csv', icon: 'üìä', label: 'CSV' },
  tsv: { type: 'csv', icon: 'üìä', label: 'TSV' },
  xlsx: { type: 'excel', icon: 'üìä', label: 'Excel' },
  xls: { type: 'excel', icon: 'üìä', label: 'Excel' },
  
  // Images
  png: { type: 'image', icon: 'üñºÔ∏è', label: 'PNG Image' },
  jpg: { type: 'image', icon: 'üñºÔ∏è', label: 'JPEG Image' },
  jpeg: { type: 'image', icon: 'üñºÔ∏è', label: 'JPEG Image' },
  gif: { type: 'image', icon: 'üñºÔ∏è', label: 'GIF Image' },
  webp: { type: 'image', icon: 'üñºÔ∏è', label: 'WebP Image' },
  svg: { type: 'svg', icon: 'üñºÔ∏è', label: 'SVG' },
  ico: { type: 'image', icon: 'üñºÔ∏è', label: 'Icon' },
  
  // PDF
  pdf: { type: 'pdf', icon: 'üìï', label: 'PDF' },
  
  // Code files
  js: { type: 'code', icon: 'üìú', label: 'JavaScript', lang: 'javascript' },
  ts: { type: 'code', icon: 'üìú', label: 'TypeScript', lang: 'typescript' },
  py: { type: 'code', icon: 'üêç', label: 'Python', lang: 'python' },
  rb: { type: 'code', icon: 'üíé', label: 'Ruby', lang: 'ruby' },
  go: { type: 'code', icon: 'üîµ', label: 'Go', lang: 'go' },
  rs: { type: 'code', icon: 'ü¶Ä', label: 'Rust', lang: 'rust' },
  java: { type: 'code', icon: '‚òï', label: 'Java', lang: 'java' },
  kt: { type: 'code', icon: 'üü£', label: 'Kotlin', lang: 'kotlin' },
  swift: { type: 'code', icon: 'üçé', label: 'Swift', lang: 'swift' },
  php: { type: 'code', icon: 'üêò', label: 'PHP', lang: 'php' },
  c: { type: 'code', icon: '‚öôÔ∏è', label: 'C', lang: 'c' },
  cpp: { type: 'code', icon: '‚öôÔ∏è', label: 'C++', lang: 'cpp' },
  h: { type: 'code', icon: '‚öôÔ∏è', label: 'C Header', lang: 'c' },
  cs: { type: 'code', icon: 'üü¢', label: 'C#', lang: 'csharp' },
  sh: { type: 'code', icon: 'üíª', label: 'Shell', lang: 'bash' },
  bash: { type: 'code', icon: 'üíª', label: 'Bash', lang: 'bash' },
  sql: { type: 'code', icon: 'üóÉÔ∏è', label: 'SQL', lang: 'sql' },
  xml: { type: 'code', icon: 'üì∞', label: 'XML', lang: 'xml' },
  
  // Config files
  toml: { type: 'code', icon: '‚öôÔ∏è', label: 'TOML', lang: 'toml' },
  ini: { type: 'code', icon: '‚öôÔ∏è', label: 'INI', lang: 'ini' },
  env: { type: 'code', icon: '‚öôÔ∏è', label: 'ENV', lang: 'bash' },
  
  // Text
  txt: { type: 'text', icon: 'üìÑ', label: 'Text' },
  log: { type: 'text', icon: 'üìÑ', label: 'Log' },
};

// Current state
let currentFile = null;
let currentContent = null;
let currentType = null;
let isEditorMode = false;

// ‚îÄ‚îÄ Event Listeners ‚îÄ‚îÄ
dropzone.addEventListener('click', () => fileInput.click());
fileInput.addEventListener('change', (e) => handleFiles(e.target.files));
clearBtn.addEventListener('click', resetAll);
closePreview.addEventListener('click', resetAll);
newFileBtn.addEventListener('click', openEditorMode);
downloadBtn.addEventListener('click', downloadAsHTML);
buildDownloadBtn.addEventListener('click', downloadAsBuiltHTML);
runBtn.addEventListener('click', runEditorCode);

// Auto-run on input (debounced)
let editorTimer = null;
editorTextarea.addEventListener('input', () => {
  clearTimeout(editorTimer);
  editorTimer = setTimeout(() => {
    detectAndUpdateType();
    runEditorCode();
  }, 400);
});

// Ctrl+Enter to run
editorTextarea.addEventListener('keydown', (e) => {
  if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {
    e.preventDefault();
    detectAndUpdateType();
    runEditorCode();
  }
  // Tab support
  if (e.key === 'Tab') {
    e.preventDefault();
    const start = editorTextarea.selectionStart;
    const end = editorTextarea.selectionEnd;
    editorTextarea.value = editorTextarea.value.substring(0, start) + '  ' + editorTextarea.value.substring(end);
    editorTextarea.selectionStart = editorTextarea.selectionEnd = start + 2;
  }
});

// Preview background toggle
document.querySelectorAll('.preview-bg-toggle button').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.preview-bg-toggle button').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    const bg = btn.dataset.bg;
    editorPreviewArea.classList.remove('dark-bg', 'transparent-bg');
    if (bg === 'dark') editorPreviewArea.classList.add('dark-bg');
    if (bg === 'transparent') editorPreviewArea.classList.add('transparent-bg');
  });
});

// Editor resize handle
let isResizing = false;
editorResizeHandle.addEventListener('mousedown', () => {
  isResizing = true;
  editorResizeHandle.classList.add('active');
  document.body.style.cursor = 'col-resize';
  document.body.style.userSelect = 'none';
});

document.addEventListener('mousemove', (e) => {
  if (!isResizing) return;
  const container = editorMode;
  const rect = container.getBoundingClientRect();
  const ratio = Math.max(0.2, Math.min(0.8, (e.clientX - rect.left) / rect.width));
  editorPanel.style.width = `${ratio * 100}%`;
  editorPreviewPanel.style.width = `${(1 - ratio) * 100}%`;
});

document.addEventListener('mouseup', () => {
  if (isResizing) {
    isResizing = false;
    editorResizeHandle.classList.remove('active');
    document.body.style.cursor = '';
    document.body.style.userSelect = '';
  }
});

// ‚îÄ‚îÄ Event Listeners ‚îÄ‚îÄ
dropzone.addEventListener('click', () => fileInput.click());
fileInput.addEventListener('change', (e) => handleFiles(e.target.files));
clearBtn.addEventListener('click', resetPreview);
closePreview.addEventListener('click', resetPreview);

// Drag & Drop
['dragenter', 'dragover', 'dragleave', 'drop'].forEach(evt => {
  document.body.addEventListener(evt, e => { e.preventDefault(); e.stopPropagation(); });
});

document.body.addEventListener('dragenter', () => dropzone.classList.add('dragover'));
document.body.addEventListener('dragleave', (e) => {
  if (!e.relatedTarget || e.relatedTarget === document.body) {
    dropzone.classList.remove('dragover');
  }
});
document.body.addEventListener('drop', (e) => {
  dropzone.classList.remove('dragover');
  handleFiles(e.dataTransfer.files);
});

// ‚îÄ‚îÄ File Handling ‚îÄ‚îÄ
async function handleFiles(files) {
  if (!files || files.length === 0) return;
  
  const file = files[0]; // Handle first file
  currentFile = file;
  
  const ext = file.name.split('.').pop().toLowerCase();
  const fileInfo = FILE_TYPES[ext] || { type: 'text', icon: 'üìÑ', label: 'Text' };
  currentType = fileInfo;
  
  // Update UI
  $('fileIcon').textContent = fileInfo.icon;
  $('fileName').textContent = file.name;
  $('fileSize').textContent = formatSize(file.size);
  $('fileType').textContent = fileInfo.label;
  
  dropzone.style.display = 'none';
  previewContainer.classList.add('active');
  clearBtn.style.display = 'flex';
  
  // Show loading
  previewArea.innerHTML = '<div class="loading"><div class="spinner"></div><div>Ë™≠„ÅøËæº„Åø‰∏≠...</div></div>';
  previewToolbar.innerHTML = '';
  
  try {
    await renderPreview(file, fileInfo);
    showToast(`‚úÖ ${file.name} „ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü`, 'success');
  } catch (err) {
    console.error(err);
    showError('Ë™≠„ÅøËæº„Åø„Ç®„É©„Éº', err.message);
    showToast(`‚ùå ${err.message}`, 'error');
  }
}

async function renderPreview(file, fileInfo) {
  switch (fileInfo.type) {
    case 'jsx':
      await renderJSX(file);
      break;
    case 'html':
      await renderHTML(file);
      break;
    case 'json':
      await renderJSON(file);
      break;
    case 'yaml':
      await renderYAML(file);
      break;
    case 'markdown':
      await renderMarkdown(file);
      break;
    case 'csv':
      await renderCSV(file);
      break;
    case 'excel':
      await renderExcel(file);
      break;
    case 'image':
      await renderImage(file);
      break;
    case 'svg':
      await renderSVG(file);
      break;
    case 'pdf':
      await renderPDF(file);
      break;
    case 'code':
      await renderCode(file, fileInfo.lang);
      break;
    case 'text':
    default:
      await renderText(file);
      break;
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// Renderers
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// ‚îÄ‚îÄ JSX/TSX ‚îÄ‚îÄ
async function renderJSX(file) {
  const code = await file.text();
  currentContent = code;
  
  setToolbar([
    { group: 'view', items: [
      { id: 'render', label: '‚ñ∂ „É¨„É≥„ÉÄ„É™„É≥„Ç∞', active: true },
      { id: 'source', label: 'üìù „ÇΩ„Éº„Çπ' },
    ]},
    { group: 'bg', items: [
      { id: 'light', label: 'Light', active: true },
      { id: 'dark', label: 'Dark' },
      { id: 'transparent', label: 'ÈÄèÈÅé' },
    ]},
  ]);
  
  renderJSXCode(code);
}

function renderJSXCode(code) {
  try {
    const processed = preprocessJSX(code);
    const componentName = detectComponentName(processed);
    
    const wrapped = processed + `\n\nReactDOM.createRoot(document.getElementById('render-root')).render(React.createElement(${componentName}));`;
    const result = Babel.transform(wrapped, {
      presets: ['react', 'typescript'],
      filename: 'preview.tsx',
    });
    
    previewArea.innerHTML = '<div class="preview-render"><div id="render-root"></div></div>';
    
    // Pass all available libraries
    const fn = new Function('React', 'ReactDOM', 'LucideReact', result.code);
    fn(React, ReactDOM, window.LucideReact || {});
  } catch (err) {
    showError('JSX„Ç®„É©„Éº', err.message);
  }
}

function preprocessJSX(code) {
  // Join multi-line imports
  code = code.replace(/import\s*\{[^}]*\n[^}]*\}/g, m => m.replace(/\n/g, ' '));
  
  const lines = code.split('\n');
  const output = [];
  
  for (let line of lines) {
    const trimmed = line.trim();
    
    // Skip type-only imports
    if (/^import\s+type\s/.test(trimmed)) {
      output.push('// ' + trimmed);
      continue;
    }
    
    // Transform react imports
    if (/^import\s/.test(trimmed)) {
      const transformed = transformImport(trimmed);
      output.push(transformed);
      continue;
    }
    
    // Handle exports
    if (/^export\s+default\s+/.test(trimmed)) {
      const rest = trimmed.replace(/^export\s+default\s+/, '');
      if (/^function\s*\(/.test(rest) || /^\(/.test(rest)) {
        output.push('const App = ' + rest);
      } else if (/^[A-Z]\w*;?\s*$/.test(rest)) {
        output.push('// export default ' + rest);
      } else {
        output.push(line.replace(/export\s+default\s+/, ''));
      }
      continue;
    }
    
    if (/^export\s+(const|let|var|function|class)\s/.test(trimmed)) {
      output.push(line.replace(/export\s+/, ''));
      continue;
    }
    
    output.push(line);
  }
  
  return output.join('\n');
}

function transformImport(line) {
  // Remove type imports inside braces
  line = line.replace(/\{([^}]*)\}/, (m, inner) => {
    const filtered = inner.split(',').filter(s => !s.trim().startsWith('type ')).join(',');
    return filtered.trim() ? `{ ${filtered} }` : '';
  });
  
  const source = line.match(/from\s+['"](.+?)['"]/)?.[1];
  if (!source) return '// ' + line;
  
  const moduleMap = { 
    'react': 'React', 
    'react-dom': 'ReactDOM', 
    'react-dom/client': 'ReactDOM',
    'lucide-react': 'LucideReact'
  };
  const globalObj = moduleMap[source];
  
  if (!globalObj) return '// [skipped] ' + line;
  
  const results = [];
  
  // Namespace import
  const nsMatch = line.match(/import\s+\*\s+as\s+(\w+)/);
  if (nsMatch && nsMatch[1] !== globalObj) {
    results.push(`const ${nsMatch[1]} = ${globalObj};`);
  }
  
  // Default import
  const defaultMatch = line.match(/import\s+([A-Za-z_$][\w$]*)\s*[,\s]/);
  if (defaultMatch && defaultMatch[1] !== globalObj && defaultMatch[1] !== '*') {
    results.push(`const ${defaultMatch[1]} = ${globalObj};`);
  }
  
  // Named imports
  const namedMatch = line.match(/\{([^}]+)\}/);
  if (namedMatch) {
    const specs = namedMatch[1].split(',').map(s => s.trim()).filter(Boolean);
    if (specs.length) {
      const destructured = specs.map(s => {
        const [orig, alias] = s.split(/\s+as\s+/).map(x => x.trim());
        return alias && alias !== orig ? `${orig}: ${alias}` : orig;
      });
      results.push(`const { ${destructured.join(', ')} } = ${globalObj};`);
    }
  }
  
  return results.length ? results.join('\n') : '// ' + line;
}

function detectComponentName(code) {
  if (/(?:const|function)\s+App[\s=(]/.test(code)) return 'App';
  const matches = [...code.matchAll(/(?:const|function)\s+([A-Z][A-Za-z0-9]*)\s*[=(]/g)];
  return matches.length ? matches[matches.length - 1][1] : 'App';
}

// ‚îÄ‚îÄ HTML ‚îÄ‚îÄ
async function renderHTML(file) {
  const html = await file.text();
  currentContent = html;
  
  setToolbar([
    { group: 'view', items: [
      { id: 'render', label: 'üåê „Éó„É¨„Éì„É•„Éº', active: true },
      { id: 'source', label: 'üìù „ÇΩ„Éº„Çπ' },
    ]},
  ]);
  
  const iframe = document.createElement('iframe');
  iframe.style.cssText = 'width:100%;height:100%;border:none;background:#fff;';
  iframe.srcdoc = html;
  previewArea.innerHTML = '';
  previewArea.appendChild(iframe);
}

// ‚îÄ‚îÄ JSON ‚îÄ‚îÄ
async function renderJSON(file) {
  const text = await file.text();
  const data = JSON.parse(text);
  currentContent = data;
  
  const isArray = Array.isArray(data);
  const isArrayOfObjects = isArray && data.length > 0 && typeof data[0] === 'object';
  
  setToolbar([
    { group: 'view', items: [
      { id: 'tree', label: 'üå≥ „ÉÑ„É™„Éº', active: true },
      { id: 'highlight', label: '‚ú® „Éè„Ç§„É©„Ç§„Éà' },
      ...(isArrayOfObjects ? [{ id: 'table', label: 'üìä „ÉÜ„Éº„Éñ„É´' }] : []),
    ]},
  ]);
  
  renderJSONTree(data);
}

function renderJSONTree(data, collapsed = false) {
  previewArea.innerHTML = `<div class="json-tree">${jsonToTree(data, 0, collapsed)}</div>`;
  
  // Add toggle listeners
  previewArea.querySelectorAll('.json-toggle').forEach(toggle => {
    toggle.addEventListener('click', () => {
      const content = toggle.nextElementSibling;
      const isCollapsed = content.classList.toggle('json-collapsed');
      toggle.textContent = isCollapsed ? '‚ñ∂' : '‚ñº';
    });
  });
}

function jsonToTree(data, depth = 0, startCollapsed = false) {
  const indent = '  '.repeat(depth);
  const nextIndent = '  '.repeat(depth + 1);
  
  if (data === null) return `<span class="json-null">null</span>`;
  if (typeof data === 'boolean') return `<span class="json-boolean">${data}</span>`;
  if (typeof data === 'number') return `<span class="json-number">${data}</span>`;
  if (typeof data === 'string') return `<span class="json-string">"${escapeHtml(data)}"</span>`;
  
  if (Array.isArray(data)) {
    if (data.length === 0) return `<span class="json-bracket">[]</span>`;
    const collapsed = startCollapsed && depth > 0 ? 'json-collapsed' : '';
    const toggle = startCollapsed && depth > 0 ? '‚ñ∂' : '‚ñº';
    const items = data.map((item, i) => {
      const comma = i < data.length - 1 ? '<span class="json-comma">,</span>' : '';
      return `${nextIndent}${jsonToTree(item, depth + 1, startCollapsed)}${comma}`;
    }).join('\n');
    return `<span class="json-toggle">${toggle}</span><span class="${collapsed}"><span class="json-bracket">[</span>\n${items}\n${indent}<span class="json-bracket">]</span></span>`;
  }
  
  if (typeof data === 'object') {
    const keys = Object.keys(data);
    if (keys.length === 0) return `<span class="json-bracket">{}</span>`;
    const collapsed = startCollapsed && depth > 0 ? 'json-collapsed' : '';
    const toggle = startCollapsed && depth > 0 ? '‚ñ∂' : '‚ñº';
    const items = keys.map((key, i) => {
      const comma = i < keys.length - 1 ? '<span class="json-comma">,</span>' : '';
      return `${nextIndent}<span class="json-key">"${escapeHtml(key)}"</span>: ${jsonToTree(data[key], depth + 1, startCollapsed)}${comma}`;
    }).join('\n');
    return `<span class="json-toggle">${toggle}</span><span class="${collapsed}"><span class="json-bracket">{</span>\n${items}\n${indent}<span class="json-bracket">}</span></span>`;
  }
  
  return String(data);
}

function renderJSONHighlight(data) {
  const json = JSON.stringify(data, null, 2);
  previewArea.innerHTML = `<pre class="preview-code"><code class="language-json">${escapeHtml(json)}</code></pre>`;
  hljs.highlightAll();
}

function renderJSONTable(data) {
  if (!Array.isArray(data) || !data.length) return;
  
  const headers = [...new Set(data.flatMap(item => Object.keys(item)))];
  
  let html = '<div class="preview-table-wrap"><table class="preview-table"><thead><tr>';
  headers.forEach(h => html += `<th>${escapeHtml(h)}</th>`);
  html += '</tr></thead><tbody>';
  
  data.forEach(row => {
    html += '<tr>';
    headers.forEach(h => {
      const val = row[h];
      const display = val === undefined ? '' : typeof val === 'object' ? JSON.stringify(val) : String(val);
      html += `<td title="${escapeHtml(display)}">${escapeHtml(display)}</td>`;
    });
    html += '</tr>';
  });
  
  html += '</tbody></table></div>';
  previewArea.innerHTML = html;
}

// ‚îÄ‚îÄ YAML ‚îÄ‚îÄ
async function renderYAML(file) {
  const text = await file.text();
  const data = jsyaml.load(text);
  currentContent = data;
  
  const isArray = Array.isArray(data);
  const isArrayOfObjects = isArray && data.length > 0 && typeof data[0] === 'object';
  
  setToolbar([
    { group: 'view', items: [
      { id: 'tree', label: 'üå≥ „ÉÑ„É™„Éº', active: true },
      { id: 'highlight', label: '‚ú® „Éè„Ç§„É©„Ç§„Éà' },
      ...(isArrayOfObjects ? [{ id: 'table', label: 'üìä „ÉÜ„Éº„Éñ„É´' }] : []),
    ]},
  ]);
  
  renderJSONTree(data);
}

// ‚îÄ‚îÄ Markdown ‚îÄ‚îÄ
async function renderMarkdown(file) {
  const text = await file.text();
  currentContent = text;
  
  setToolbar([
    { group: 'view', items: [
      { id: 'render', label: 'üìñ „Éó„É¨„Éì„É•„Éº', active: true },
      { id: 'source', label: 'üìù „ÇΩ„Éº„Çπ' },
    ]},
  ]);
  
  const html = marked.parse(text);
  previewArea.innerHTML = `<div class="preview-markdown">${html}</div>`;
  previewArea.querySelectorAll('pre code').forEach(block => hljs.highlightElement(block));
}

// ‚îÄ‚îÄ CSV ‚îÄ‚îÄ
async function renderCSV(file) {
  const text = await file.text();
  const delimiter = file.name.endsWith('.tsv') ? '\t' : ',';
  const rows = parseCSV(text, delimiter);
  currentContent = rows;
  
  setToolbar([
    { group: 'info', items: [
      { id: 'info', label: `${rows.length} Ë°å √ó ${rows[0]?.length || 0} Âàó`, disabled: true },
    ]},
  ]);
  
  renderTable(rows);
}

function parseCSV(text, delimiter = ',') {
  const rows = [];
  let row = [];
  let cell = '';
  let inQuotes = false;
  
  for (let i = 0; i < text.length; i++) {
    const char = text[i];
    const next = text[i + 1];
    
    if (inQuotes) {
      if (char === '"' && next === '"') {
        cell += '"';
        i++;
      } else if (char === '"') {
        inQuotes = false;
      } else {
        cell += char;
      }
    } else {
      if (char === '"') {
        inQuotes = true;
      } else if (char === delimiter) {
        row.push(cell);
        cell = '';
      } else if (char === '\r' && next === '\n') {
        row.push(cell);
        rows.push(row);
        row = [];
        cell = '';
        i++;
      } else if (char === '\n') {
        row.push(cell);
        rows.push(row);
        row = [];
        cell = '';
      } else {
        cell += char;
      }
    }
  }
  
  if (cell || row.length) {
    row.push(cell);
    rows.push(row);
  }
  
  return rows;
}

function renderTable(rows) {
  if (!rows.length) return;
  
  let html = '<div class="preview-table-wrap"><table class="preview-table"><thead><tr>';
  rows[0].forEach(h => html += `<th>${escapeHtml(h)}</th>`);
  html += '</tr></thead><tbody>';
  
  rows.slice(1).forEach(row => {
    html += '<tr>';
    row.forEach(cell => html += `<td title="${escapeHtml(cell)}">${escapeHtml(cell)}</td>`);
    html += '</tr>';
  });
  
  html += '</tbody></table></div>';
  previewArea.innerHTML = html;
}

// ‚îÄ‚îÄ Excel ‚îÄ‚îÄ
async function renderExcel(file) {
  const buffer = await file.arrayBuffer();
  const workbook = XLSX.read(buffer, { type: 'array' });
  
  const sheetNames = workbook.SheetNames;
  currentContent = workbook;
  
  setToolbar([
    { group: 'sheets', items: sheetNames.map((name, i) => ({
      id: `sheet-${i}`,
      label: name,
      active: i === 0,
    }))},
  ]);
  
  renderExcelSheet(workbook, sheetNames[0]);
}

function renderExcelSheet(workbook, sheetName) {
  const sheet = workbook.Sheets[sheetName];
  const rows = XLSX.utils.sheet_to_json(sheet, { header: 1 });
  renderTable(rows);
}

// ‚îÄ‚îÄ Image ‚îÄ‚îÄ
async function renderImage(file) {
  const url = URL.createObjectURL(file);
  currentContent = url;
  
  setToolbar([
    { group: 'bg', items: [
      { id: 'dark', label: 'Dark', active: true },
      { id: 'light', label: 'Light' },
      { id: 'tiled', label: '„Çø„Ç§„É´' },
    ]},
  ]);
  
  previewArea.innerHTML = `<div class="preview-image"><img src="${url}" alt="${escapeHtml(file.name)}"></div>`;
}

// ‚îÄ‚îÄ SVG ‚îÄ‚îÄ
async function renderSVG(file) {
  const text = await file.text();
  const url = URL.createObjectURL(file);
  currentContent = { text, url };
  
  setToolbar([
    { group: 'view', items: [
      { id: 'render', label: 'üñºÔ∏è „Éó„É¨„Éì„É•„Éº', active: true },
      { id: 'source', label: 'üìù „ÇΩ„Éº„Çπ' },
    ]},
    { group: 'bg', items: [
      { id: 'dark', label: 'Dark', active: true },
      { id: 'light', label: 'Light' },
      { id: 'tiled', label: '„Çø„Ç§„É´' },
    ]},
  ]);
  
  previewArea.innerHTML = `<div class="preview-image"><img src="${url}" alt="${escapeHtml(file.name)}"></div>`;
}

// ‚îÄ‚îÄ PDF ‚îÄ‚îÄ
async function renderPDF(file) {
  const buffer = await file.arrayBuffer();
  pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
  
  const pdf = await pdfjsLib.getDocument({ data: buffer }).promise;
  currentContent = pdf;
  
  setToolbar([
    { group: 'info', items: [
      { id: 'info', label: `${pdf.numPages} „Éö„Éº„Ç∏`, disabled: true },
    ]},
  ]);
  
  previewArea.innerHTML = '<div class="preview-pdf" id="pdfContainer"></div>';
  const container = $('pdfContainer');
  
  for (let i = 1; i <= Math.min(pdf.numPages, 20); i++) {
    const page = await pdf.getPage(i);
    const scale = 1.5;
    const viewport = page.getViewport({ scale });
    
    const canvas = document.createElement('canvas');
    canvas.className = 'pdf-page';
    canvas.width = viewport.width;
    canvas.height = viewport.height;
    
    await page.render({
      canvasContext: canvas.getContext('2d'),
      viewport: viewport,
    }).promise;
    
    container.appendChild(canvas);
  }
  
  if (pdf.numPages > 20) {
    container.innerHTML += `<div style="padding:20px;color:#fff;text-align:center;">... ÊÆã„Çä ${pdf.numPages - 20} „Éö„Éº„Ç∏</div>`;
  }
}

// ‚îÄ‚îÄ Code (with syntax highlighting) ‚îÄ‚îÄ
async function renderCode(file, lang) {
  const text = await file.text();
  currentContent = text;
  
  setToolbar([]);
  
  const highlighted = lang ? hljs.highlight(text, { language: lang }).value : escapeHtml(text);
  previewArea.innerHTML = `<pre class="preview-code"><code>${highlighted}</code></pre>`;
}

// ‚îÄ‚îÄ Text ‚îÄ‚îÄ
async function renderText(file) {
  const text = await file.text();
  currentContent = text;
  
  setToolbar([]);
  
  previewArea.innerHTML = `<pre class="preview-code">${escapeHtml(text)}</pre>`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// Toolbar & UI Helpers
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function setToolbar(groups) {
  previewToolbar.innerHTML = groups.map(group => {
    const buttons = group.items.map(item => 
      `<button class="toolbar-btn ${item.active ? 'active' : ''}" 
        data-group="${group.group}" data-id="${item.id}" 
        ${item.disabled ? 'disabled' : ''}>${item.label}</button>`
    ).join('');
    return `<div class="toolbar-group">${buttons}</div>`;
  }).join('<div class="toolbar-divider"></div>');
  
  // Add click handlers
  previewToolbar.querySelectorAll('.toolbar-btn:not([disabled])').forEach(btn => {
    btn.addEventListener('click', () => handleToolbarClick(btn.dataset.group, btn.dataset.id, btn));
  });
}

function handleToolbarClick(group, id, btn) {
  // Update active state within group
  previewToolbar.querySelectorAll(`[data-group="${group}"]`).forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  
  // Handle actions based on current file type
  if (currentType.type === 'jsx') {
    if (id === 'render') renderJSXCode(currentContent);
    if (id === 'source') renderCode({ text: () => Promise.resolve(currentContent) }, 'javascript');
    if (id === 'light') document.querySelector('.preview-render')?.classList.remove('dark-bg', 'transparent-bg');
    if (id === 'dark') { 
      document.querySelector('.preview-render')?.classList.add('dark-bg');
      document.querySelector('.preview-render')?.classList.remove('transparent-bg');
    }
    if (id === 'transparent') {
      document.querySelector('.preview-render')?.classList.add('transparent-bg');
      document.querySelector('.preview-render')?.classList.remove('dark-bg');
    }
  }
  
  if (currentType.type === 'html') {
    if (id === 'render') renderHTML({ text: () => Promise.resolve(currentContent) });
    if (id === 'source') {
      previewArea.innerHTML = `<pre class="preview-code"><code>${hljs.highlight(currentContent, { language: 'html' }).value}</code></pre>`;
    }
  }
  
  if (currentType.type === 'json' || currentType.type === 'yaml') {
    if (id === 'tree') renderJSONTree(currentContent);
    if (id === 'highlight') renderJSONHighlight(currentContent);
    if (id === 'table') renderJSONTable(currentContent);
  }
  
  if (currentType.type === 'markdown') {
    if (id === 'render') {
      const html = marked.parse(currentContent);
      previewArea.innerHTML = `<div class="preview-markdown">${html}</div>`;
      previewArea.querySelectorAll('pre code').forEach(block => hljs.highlightElement(block));
    }
    if (id === 'source') {
      previewArea.innerHTML = `<pre class="preview-code"><code>${escapeHtml(currentContent)}</code></pre>`;
    }
  }
  
  if (currentType.type === 'svg') {
    if (id === 'render') {
      previewArea.innerHTML = `<div class="preview-image"><img src="${currentContent.url}" alt="SVG"></div>`;
    }
    if (id === 'source') {
      previewArea.innerHTML = `<pre class="preview-code"><code>${hljs.highlight(currentContent.text, { language: 'xml' }).value}</code></pre>`;
    }
  }
  
  if (currentType.type === 'image' || currentType.type === 'svg') {
    const imgContainer = previewArea.querySelector('.preview-image');
    if (imgContainer) {
      imgContainer.classList.remove('tiled');
      imgContainer.style.background = '';
      if (id === 'dark') imgContainer.style.background = '#1a1a2e';
      if (id === 'light') imgContainer.style.background = '#fff';
      if (id === 'tiled') imgContainer.classList.add('tiled');
    }
  }
  
  if (currentType.type === 'excel' && id.startsWith('sheet-')) {
    const sheetIndex = parseInt(id.split('-')[1]);
    const sheetName = currentContent.SheetNames[sheetIndex];
    renderExcelSheet(currentContent, sheetName);
  }
}

function showError(title, message) {
  previewArea.innerHTML = `
    <div class="preview-error">
      <div class="error-icon">‚ùå</div>
      <div class="error-title">${escapeHtml(title)}</div>
      <div class="error-message">${escapeHtml(message)}</div>
    </div>
  `;
}

function resetPreview() {
  currentFile = null;
  currentContent = null;
  currentType = null;
  
  dropzone.style.display = '';
  previewContainer.classList.remove('active');
  clearBtn.style.display = 'none';
  previewArea.innerHTML = '';
  previewToolbar.innerHTML = '';
  fileInput.value = '';
}

function resetAll() {
  resetPreview();
  closeEditorMode();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// Editor Mode Functions
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function openEditorMode() {
  isEditorMode = true;
  dropzone.style.display = 'none';
  previewContainer.classList.remove('active');
  editorMode.classList.add('active');
  clearBtn.style.display = 'flex';
  downloadBtn.style.display = 'flex';
  
  // Clear console
  consoleLogs.length = 0;
  if (consoleMessages) consoleMessages.innerHTML = '';
  
  // Ensure render root exists
  if (!$('editor-render-root')) {
    editorPreviewArea.innerHTML = '<div id="editor-render-root"></div>';
  }
  
  editorTextarea.placeholder = '„Ç≥„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ...\n\nÂØæÂøúÂΩ¢Âºè: JSX, HTML, Markdown, SVG, JSON, CSS, YAML „Å™„Å©\nÔºàËá™ÂãïÂà§Âà•„Åï„Çå„Åæ„ÅôÔºâ';
  editorTextarea.focus();
  
  // Load sample code if empty
  if (!editorTextarea.value.trim()) {
    loadSampleCode('jsx');
  }
  
  detectAndUpdateType();
  runEditorCode();
}

function closeEditorMode() {
  isEditorMode = false;
  editorMode.classList.remove('active');
  downloadBtn.style.display = 'none';
  if (buildDownloadBtn) buildDownloadBtn.style.display = 'none';
  editorError.style.display = 'none';
  
  // Reset preview area
  editorPreviewArea.innerHTML = '<div id="editor-render-root"></div>';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// Auto-detect Code Type
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const TYPE_INFO = {
  jsx: { icon: '‚öõÔ∏è', label: 'React JSX', color: '#61dafb' },
  html: { icon: 'üåê', label: 'HTML', color: '#e34c26' },
  markdown: { icon: 'üìù', label: 'Markdown', color: '#083fa1' },
  svg: { icon: 'üé®', label: 'SVG', color: '#ffb13b' },
  json: { icon: 'üìã', label: 'JSON', color: '#f5a623' },
  css: { icon: 'üé®', label: 'CSS', color: '#264de4' },
  yaml: { icon: 'üìÑ', label: 'YAML', color: '#cb171e' },
  text: { icon: 'üìÑ', label: 'Text', color: '#888' },
};

function detectCodeType(code) {
  if (!code || !code.trim()) return 'text';
  
  const trimmed = code.trim();
  const lines = trimmed.split('\n');
  const firstLine = lines[0].trim().toLowerCase();
  
  // ‚îÄ‚îÄ SVG Detection (check first, as it's specific) ‚îÄ‚îÄ
  if (trimmed.match(/^<svg[\s>]/i) || trimmed.includes('xmlns="http://www.w3.org/2000/svg"')) {
    return 'svg';
  }
  
  // ‚îÄ‚îÄ JSON Detection ‚îÄ‚îÄ
  if ((firstLine.startsWith('{') || firstLine.startsWith('[')) && !trimmed.includes('<')) {
    try {
      JSON.parse(trimmed);
      return 'json';
    } catch (e) {
      // Not valid JSON, continue checking
    }
  }
  
  // ‚îÄ‚îÄ YAML Detection ‚îÄ‚îÄ
  if (
    (firstLine.startsWith('---') && !trimmed.includes('<')) ||
    (trimmed.match(/^[\w-]+:\s*.+/m) && !trimmed.includes('<') && !trimmed.includes('{') && trimmed.match(/^[\w-]+:/gm)?.length >= 2)
  ) {
    // Check it's not markdown frontmatter
    if (!trimmed.match(/^#\s+/m)) {
      try {
        jsyaml.load(trimmed);
        return 'yaml';
      } catch (e) {
        // Not valid YAML
      }
    }
  }
  
  // ‚îÄ‚îÄ JSX/React Detection (BEFORE HTML - important!) ‚îÄ‚îÄ
  // Strong indicators that MUST be JSX
  const strongJsxIndicators = [
    /^import\s+.*from\s+['"]react['"]/m,              // import from 'react'
    /^import\s+.*from\s+['"]lucide-react['"]/m,       // import from 'lucide-react'
    /^import\s+React/m,                                // import React
    /^export\s+default\s+(function|const|class)\s+\w+/m,  // export default Component
    /^export\s+default\s+\w+\s*;?\s*$/m,              // export default App;
  ];
  
  // If ANY strong indicator matches, it's definitely JSX
  if (strongJsxIndicators.some(regex => regex.test(trimmed))) {
    return 'jsx';
  }
  
  // Regular JSX indicators
  const jsxIndicators = [
    /\bReact\.(useState|useEffect|useRef|createElement|Component)/,  // React.hooks
    /\b(useState|useEffect|useRef|useMemo|useCallback|useContext)\s*\(/,  // hooks usage
    /^(const|let|var|function)\s+[A-Z][A-Za-z0-9]*\s*[=(]/m,  // Component declaration
    /return\s*\(\s*</m,                               // return ( <JSX>
    /=>\s*\(\s*</m,                                   // => ( <JSX>
    /=>\s*</m,                                        // => <JSX>
    /<[A-Z][A-Za-z0-9]*[\s/>]/,                       // <ComponentName
    /className\s*=/,                                  // className=
    /onClick\s*=/,                                    // onClick=
    /onChange\s*=/,                                   // onChange=
    /onSubmit\s*=/,                                   // onSubmit=
    /style\s*=\s*\{\{/,                               // style={{ }}
    /dangerouslySetInnerHTML\s*=/,                    // dangerouslySetInnerHTML
  ];
  
  const jsxScore = jsxIndicators.filter(regex => regex.test(trimmed)).length;
  
  // Need at least 2 indicators for JSX
  if (jsxScore >= 2) {
    return 'jsx';
  }
  
  // Also detect if it looks like a React component but without explicit React imports
  if (
    trimmed.match(/^(const|function)\s+[A-Z]\w*\s*=?\s*(\(|=>)/m) &&
    trimmed.includes('<') && trimmed.includes('>')
  ) {
    return 'jsx';
  }
  
  // ‚îÄ‚îÄ HTML Detection (after JSX check) ‚îÄ‚îÄ
  if (
    firstLine.startsWith('<!doctype') ||
    firstLine.startsWith('<html') ||
    (trimmed.match(/<(head|body|link|meta|title)[>\s]/i) && trimmed.includes('</') && !trimmed.includes('import '))
  ) {
    return 'html';
  }
  
  // ‚îÄ‚îÄ CSS Detection ‚îÄ‚îÄ
  if (
    trimmed.match(/^[\.\#\@\*\w\[\:][^{]*\{[^}]*\}/m) && // selector { rules }
    !trimmed.includes('import ') &&
    !trimmed.includes('const ') &&
    !trimmed.includes('function ') &&
    trimmed.match(/[{;][\s\n]*[\w-]+\s*:\s*[^;]+;/m) // property: value;
  ) {
    return 'css';
  }
  
  // ‚îÄ‚îÄ Markdown Detection ‚îÄ‚îÄ
  const mdIndicators = [
    /^#{1,6}\s+.+/m,                    // # Heading
    /^\*{3,}$|^-{3,}$|^_{3,}$/m,        // --- or *** (hr)
    /^\s*[-*+]\s+.+/m,                   // - list item
    /^\s*\d+\.\s+.+/m,                   // 1. ordered list
    /\[.+\]\(.+\)/,                       // [link](url)
    /!\[.+\]\(.+\)/,                      // ![image](url)
    /\*\*.+\*\*/,                         // **bold**
    /\*.+\*/,                             // *italic*
    /`.+`/,                               // `code`
    /^```/m,                              // ```code block
    /^>\s+.+/m,                           // > blockquote
    /\|.+\|.+\|/,                         // | table |
  ];
  
  const mdScore = mdIndicators.filter(regex => regex.test(trimmed)).length;
  
  // If multiple markdown indicators, it's probably markdown
  if (mdScore >= 2) {
    return 'markdown';
  }
  
  // ‚îÄ‚îÄ Fallback to text ‚îÄ‚îÄ
  return 'text';
}

function detectAndUpdateType() {
  const code = editorTextarea.value;
  const type = detectCodeType(code);
  currentEditorType = type;
  
  const info = TYPE_INFO[type] || TYPE_INFO.text;
  
  detectedTypeEl.className = 'detected-type ' + type;
  detectedTypeEl.querySelector('.detected-icon').textContent = info.icon;
  detectedTypeEl.querySelector('.detected-label').textContent = info.label;
  
  // JSX„É¢„Éº„Éâ„ÅÆÊôÇ„Å†„Åë„Éì„É´„Éâ„Éú„Çø„É≥„ÇíË°®Á§∫
  if (buildDownloadBtn) {
    buildDownloadBtn.style.display = (type === 'jsx' && isEditorMode) ? 'flex' : 'none';
  }
}

function loadSampleCode(type) {
  const samples = {
    jsx: `const App = () => {
  const [count, setCount] = React.useState(0);
  
  return (
    <div style={{
      display: 'flex',
      flexDirection: 'column',
      alignItems: 'center',
      justifyContent: 'center',
      height: '100%',
      fontFamily: 'system-ui, sans-serif',
      gap: '20px'
    }}>
      <h1 style={{ fontSize: '4rem', margin: 0 }}>üöÄ</h1>
      <h2>„Ç´„Ç¶„É≥„Çø„Éº: {count}</h2>
      <div style={{ display: 'flex', gap: '10px' }}>
        <button 
          onClick={() => setCount(c => c - 1)}
          style={{
            padding: '10px 20px',
            fontSize: '16px',
            borderRadius: '8px',
            border: 'none',
            background: '#ef4444',
            color: 'white',
            cursor: 'pointer'
          }}
        >
          -1
        </button>
        <button 
          onClick={() => setCount(c => c + 1)}
          style={{
            padding: '10px 20px',
            fontSize: '16px',
            borderRadius: '8px',
            border: 'none',
            background: '#22c55e',
            color: 'white',
            cursor: 'pointer'
          }}
        >
          +1
        </button>
      </div>
    </div>
  );
};`,
    html: `<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>„Çµ„É≥„Éó„É´„Éö„Éº„Ç∏</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      margin: 0;
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
    }
    h1 { font-size: 3rem; margin-bottom: 1rem; }
    p { font-size: 1.2rem; opacity: 0.9; }
    button {
      margin-top: 20px;
      padding: 12px 24px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      background: white;
      color: #667eea;
      cursor: pointer;
      font-weight: 600;
    }
    button:hover { transform: scale(1.05); }
  </style>
</head>
<body>
  <h1>üéâ Hello World!</h1>
  <p>„Åì„Çå„ÅØ„Çµ„É≥„Éó„É´HTML„Éö„Éº„Ç∏„Åß„Åô</p>
  <button onclick="alert('„ÇØ„É™„ÉÉ„ÇØ„Åï„Çå„Åæ„Åó„ÅüÔºÅ')">„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶„Å≠</button>
</body>
</html>`,
    markdown: `# üìù Markdown „Çµ„É≥„Éó„É´

## Ë¶ãÂá∫„Åó2

„Åì„Çå„ÅØ**Â§™Â≠ó**„Åß„ÄÅ„Åì„Çå„ÅØ*„Ç§„Çø„É™„ÉÉ„ÇØ*„Åß„Åô„ÄÇ

### „É™„Çπ„Éà

- È†ÖÁõÆ1
- È†ÖÁõÆ2
- È†ÖÁõÆ3

### „Ç≥„Éº„Éâ

\`\`\`javascript
const hello = () => {
  console.log('Hello, World!');
};
\`\`\`

### ÂºïÁî®

> „Åì„Çå„ÅØÂºïÁî®Êñá„Åß„Åô„ÄÇ
> Ë§áÊï∞Ë°å„ÇÇÂèØËÉΩ„Åß„Åô„ÄÇ

### „É™„É≥„ÇØ

[Anthropic](https://anthropic.com)

---

„ÅäÊ•Ω„Åó„Åø„Åè„Å†„Åï„ÅÑÔºÅ üöÄ`,
    svg: `<svg width="200" height="200" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="grad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#667eea;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#764ba2;stop-opacity:1" />
    </linearGradient>
  </defs>
  <rect x="10" y="10" width="180" height="180" rx="20" fill="url(#grad)" />
  <text x="100" y="115" font-size="60" text-anchor="middle" fill="white">‚ú®</text>
</svg>`,
  };
  editorTextarea.value = samples[type] || '';
}

function runEditorCode() {
  const code = editorTextarea.value.trim();
  const type = currentEditorType;
  
  editorError.style.display = 'none';
  
  // Clear console before running
  consoleLogs.length = 0;
  if (consoleMessages) consoleMessages.innerHTML = '';
  
  // Ensure render root exists (might have been replaced by iframe)
  let renderRoot = $('editor-render-root');
  if (!renderRoot || type !== 'html') {
    // Reset preview area for non-HTML types
    if (type !== 'html') {
      editorPreviewArea.innerHTML = '<div id="editor-render-root"></div>';
      renderRoot = $('editor-render-root');
    }
  }
  
  if (!code) {
    if (renderRoot) {
      renderRoot.innerHTML = '<div style="color:#888;text-align:center;padding:40px;">„Ç≥„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>';
    }
    return;
  }
  
  try {
    switch (type) {
      case 'jsx':
        renderEditorJSX(code, renderRoot);
        break;
      case 'html':
        renderEditorHTML(code);
        break;
      case 'markdown':
        renderEditorMarkdown(code, renderRoot);
        break;
      case 'svg':
        renderEditorSVG(code, renderRoot);
        break;
      case 'json':
        renderEditorJSON(code, renderRoot);
        break;
      case 'css':
        renderEditorCSS(code, renderRoot);
        break;
      case 'yaml':
        renderEditorYAML(code, renderRoot);
        break;
      default:
        renderEditorText(code, renderRoot);
        break;
    }
  } catch (err) {
    showEditorError(err.message);
  }
}

function renderEditorJSX(code, container) {
  try {
    // Ensure container exists
    if (!container) {
      editorPreviewArea.innerHTML = '<div id="editor-render-root"></div>';
      container = $('editor-render-root');
    }
    
    const processed = preprocessJSX(code);
    const componentName = detectComponentName(processed);
    
    console.log('[JSX Preview] Component:', componentName);
    console.log('[JSX Preview] Processed code:', processed.slice(0, 500) + '...');
    
    const wrapped = processed + `\n\nReactDOM.createRoot(document.getElementById('editor-render-root')).render(React.createElement(${componentName}));`;
    
    let result;
    try {
      result = Babel.transform(wrapped, {
        presets: ['react', 'typescript'],
        filename: 'editor.tsx',
      });
    } catch (babelErr) {
      showEditorError('Babel Transform Error:\n' + babelErr.message);
      return;
    }
    
    container.innerHTML = '';
    
    try {
      // Pass all available libraries
      const fn = new Function('React', 'ReactDOM', 'LucideReact', result.code);
      fn(React, ReactDOM, window.LucideReact || {});
    } catch (runtimeErr) {
      showEditorError('Runtime Error:\n' + runtimeErr.message + '\n\nStack:\n' + runtimeErr.stack?.split('\n').slice(0, 5).join('\n'));
    }
  } catch (err) {
    showEditorError('JSX Preview Error:\n' + err.message);
  }
}

function renderEditorHTML(code) {
  // Use iframe for HTML preview
  let iframe = editorPreviewArea.querySelector('iframe');
  if (!iframe) {
    editorPreviewArea.innerHTML = '<iframe style="width:100%;height:100%;border:none;"></iframe>';
    iframe = editorPreviewArea.querySelector('iframe');
  }
  iframe.srcdoc = code;
}

function renderEditorMarkdown(code, container) {
  if (!container) return;
  const html = marked.parse(code);
  container.innerHTML = `<div class="preview-markdown">${html}</div>`;
  container.querySelectorAll('pre code').forEach(block => hljs.highlightElement(block));
}

function renderEditorSVG(code, container) {
  if (!container) return;
  container.innerHTML = `<div style="display:flex;align-items:center;justify-content:center;min-height:100%;">${code}</div>`;
}

function renderEditorJSON(code, container) {
  if (!container) return;
  try {
    const data = JSON.parse(code);
    container.innerHTML = `<div class="json-tree" style="padding:20px;">${jsonToTree(data, 0, false)}</div>`;
    
    // Add toggle listeners
    container.querySelectorAll('.json-toggle').forEach(toggle => {
      toggle.addEventListener('click', () => {
        const content = toggle.nextElementSibling;
        const isCollapsed = content.classList.toggle('json-collapsed');
        toggle.textContent = isCollapsed ? '‚ñ∂' : '‚ñº';
      });
    });
  } catch (err) {
    showEditorError('JSON Parse Error: ' + err.message);
  }
}

function renderEditorCSS(code, container) {
  if (!container) return;
  const highlighted = hljs.highlight(code, { language: 'css' }).value;
  container.innerHTML = `<pre class="preview-code" style="padding:20px;margin:0;"><code>${highlighted}</code></pre>`;
}

function renderEditorYAML(code, container) {
  if (!container) return;
  try {
    const data = jsyaml.load(code);
    container.innerHTML = `<div class="json-tree" style="padding:20px;">${jsonToTree(data, 0, false)}</div>`;
    
    container.querySelectorAll('.json-toggle').forEach(toggle => {
      toggle.addEventListener('click', () => {
        const content = toggle.nextElementSibling;
        const isCollapsed = content.classList.toggle('json-collapsed');
        toggle.textContent = isCollapsed ? '‚ñ∂' : '‚ñº';
      });
    });
  } catch (err) {
    showEditorError('YAML Parse Error: ' + err.message);
  }
}

function renderEditorText(code, container) {
  if (!container) return;
  container.innerHTML = `<pre class="preview-code" style="padding:20px;margin:0;">${escapeHtml(code)}</pre>`;
}

function showEditorError(message) {
  // „Ç®„É©„Éº„Éë„Éç„É´„Å´Ë°®Á§∫
  let displayMsg = message;
  const explanation = getErrorExplanation(message);
  if (explanation) {
    displayMsg = message + '\n\n' + explanation;
  }
  editorError.textContent = displayMsg;
  editorError.style.display = 'block';
  
  // „Ç≥„É≥„ÇΩ„Éº„É´„Å´„ÇÇÂá∫Âäõ
  console.error(message);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// Download as HTML
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function downloadAsHTML() {
  const code = editorTextarea.value.trim();
  const type = currentEditorType;
  
  if (!code) {
    showToast('‚ùå „Ç≥„Éº„Éâ„Åå„ÅÇ„Çä„Åæ„Åõ„Çì', 'error');
    return;
  }
  
  let html = '';
  let filename = 'download.html';
  
  switch (type) {
    case 'jsx':
      html = generateJSXHTML(code);
      filename = 'react-app.html';
      break;
    case 'html':
      html = code;
      filename = 'page.html';
      break;
    case 'markdown':
      html = generateMarkdownHTML(code);
      filename = 'document.html';
      break;
    case 'svg':
      html = generateSVGHTML(code);
      filename = 'image.html';
      break;
    case 'json':
      html = generateDataHTML(code, 'JSON', 'json');
      filename = 'data.html';
      break;
    case 'css':
      html = generateCodeHTML(code, 'CSS', 'css');
      filename = 'styles.html';
      break;
    case 'yaml':
      html = generateDataHTML(code, 'YAML', 'yaml');
      filename = 'config.html';
      break;
    default:
      html = generateCodeHTML(code, 'Text', 'plaintext');
      filename = 'text.html';
      break;
  }
  
  downloadFile(html, filename, 'text/html');
  showToast(`‚úÖ ${filename} „Çí„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Åó„Åæ„Åó„Åü`, 'success');
}

// „Éì„É´„ÉâÊ∏à„ÅøÔºà„Éà„É©„É≥„Çπ„Éë„Ç§„É´Ê∏à„ÅøÔºâHTML„Çí„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ
function downloadAsBuiltHTML() {
  const code = editorTextarea.value.trim();
  
  if (!code) {
    showToast('‚ùå „Ç≥„Éº„Éâ„Åå„ÅÇ„Çä„Åæ„Åõ„Çì', 'error');
    return;
  }
  
  if (currentEditorType !== 'jsx') {
    showToast('‚ùå JSX„É¢„Éº„Éâ„Åß„ÅÆ„Åø‰ΩøÁî®ÂèØËÉΩ„Åß„Åô', 'error');
    return;
  }
  
  try {
    const processed = preprocessJSX(code);
    const componentName = detectComponentName(processed);
    
    // Babel„Åß„Éà„É©„É≥„Çπ„Éë„Ç§„É´
    const wrapped = processed + `\n\nReactDOM.createRoot(document.getElementById('root')).render(React.createElement(${componentName}));`;
    
    const result = Babel.transform(wrapped, {
      presets: ['react', 'typescript'],
      filename: 'app.tsx',
    });
    
    const transpiledCode = result.code;
    
    // Tailwind‰ΩøÁî®„ÉÅ„Çß„ÉÉ„ÇØ
    const usesTailwind = /className\s*=\s*["'][^"']*(?:bg-|text-|flex|grid|p-|m-|w-|h-|rounded|border|shadow|hover:|focus:)/.test(code);
    const tailwindScript = usesTailwind ? '<script src="https://cdn.tailwindcss.com"><\/script>' : '';
    
    // Lucide‰ΩøÁî®„ÉÅ„Çß„ÉÉ„ÇØ
    const usesLucide = code.includes('lucide-react') || code.includes('from "lucide-react"');
    
    // LucideReact„Ç∑„É†Ôºà„Éì„É´„ÉâÊ∏à„ÅøÁâàÔºâ
    const lucideShim = usesLucide ? `
// LucideReact Shim (Built-in)
var LucideReact = (function() {
  var icons = {Plus:'M12 5v14M5 12h14',X:'M18 6L6 18M6 6l12 12',Check:'M20 6L9 17l-5-5',ChevronLeft:'M15 18l-6-6 6-6',ChevronRight:'M9 18l6-6-6-6',ChevronUp:'M18 15l-6-6-6 6',ChevronDown:'M6 9l6 6 6-6',Menu:'M4 6h16M4 12h16M4 18h16',Search:'M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z',Settings2:'M4 21v-7m0-4V3m8 18v-9m0-4V3m8 18v-5m0-4V3M1 14h6m2-6h6m2 8h6',Trash2:'M3 6h18m-2 0v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2m-6 5v6m4-6v6',Save:'M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2zM17 21v-8H7v8M7 3v5h8',Download:'M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4m4-5l5 5 5-5m-5 5V3',Upload:'M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4m14-7l-5-5-5 5m5-5v12',FileText:'M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8l-6-6zM14 2v6h6m-4 5H8m8 4H8m2-8H8',FileSearch:'M4 22h14a2 2 0 002-2V7.5L14.5 2H6a2 2 0 00-2 2v3m14 0V2l6 6h-6M4 14a3 3 0 100 6 3 3 0 000-6zm-2.5 7.5L4 19',ExternalLink:'M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6m4-3h6v6m-11 5L21 3',Globe:'M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10zM2 12h20M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z',PlusCircle:'M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10zM12 8v8m-4-4h8',Archive:'M21 8v13H3V8M1 3h22v5H1V3zm9 9h4',RefreshCw:'M23 4v6h-6M1 20v-6h6M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15',Sparkles:'M12 3l1.912 5.813a2 2 0 001.275 1.275L21 12l-5.813 1.912a2 2 0 00-1.275 1.275L12 21l-1.912-5.813a2 2 0 00-1.275-1.275L3 12l5.813-1.912a2 2 0 001.275-1.275L12 3zM5 3v4M19 17v4M3 5h4m10 14h4',Loader2:'M21 12a9 9 0 11-6.219-8.56',MessageSquare:'M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z',Code:'M16 18l6-6-6-6M8 6l-6 6 6 6',Send:'M22 2L11 13m11-11l-7 20-4-9-9-4 20-7z',Copy:'M20 9h-9a2 2 0 00-2 2v9a2 2 0 002 2h9a2 2 0 002-2v-9a2 2 0 00-2-2zM5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1',AlertCircle:'M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10zM12 8v4m0 4h.01',Info:'M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10zM12 16v-4m0-4h.01',Home:'M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2V9z',User:'M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2M12 11a4 4 0 100-8 4 4 0 000 8z',Heart:'M20.84 4.61a5.5 5.5 0 00-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 00-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 000-7.78z',Star:'M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z',Mail:'M4 4h16a2 2 0 012 2v12a2 2 0 01-2 2H4a2 2 0 01-2-2V6a2 2 0 012-2zm18 2l-10 7L2 6',Bell:'M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9M13.73 21a2 2 0 01-3.46 0',Lock:'M19 11H5a2 2 0 00-2 2v7a2 2 0 002 2h14a2 2 0 002-2v-7a2 2 0 00-2-2zM7 11V7a5 5 0 0110 0v4',Eye:'M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8zM12 15a3 3 0 100-6 3 3 0 000 6z',Activity:'M22 12h-4l-3 9L9 3l-3 9H2'};
  var base = {};
  for (var name in icons) {
    (function(n, d) {
      base[n] = function(p) {
        p = p || {};
        var size = p.size || 24, color = p.color || 'currentColor', strokeWidth = p.strokeWidth || 2, className = p.className || '', style = p.style || {};
        return React.createElement('svg', { xmlns: 'http://www.w3.org/2000/svg', width: size, height: size, viewBox: '0 0 24 24', fill: 'none', stroke: color, strokeWidth: strokeWidth, strokeLinecap: 'round', strokeLinejoin: 'round', className: className, style: style }, React.createElement('path', { d: d }));
      };
    })(name, icons[name]);
  }
  var fallback = function(p) {
    p = p || {};
    var size = p.size || 24, color = p.color || 'currentColor', strokeWidth = p.strokeWidth || 2, className = p.className || '', style = p.style || {};
    return React.createElement('svg', { xmlns: 'http://www.w3.org/2000/svg', width: size, height: size, viewBox: '0 0 24 24', fill: 'none', stroke: color, strokeWidth: strokeWidth, strokeLinecap: 'round', strokeLinejoin: 'round', className: className, style: style }, React.createElement('circle', { cx: 12, cy: 12, r: 10 }));
  };
  return new Proxy(base, { get: function(t, p) { return t[p] || fallback; } });
})();
` : '';

    // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥CSS
    const animateStyles = `
  .animate-in { animation: enter 0.3s ease-out; }
  .fade-in { --tw-enter-opacity: 0; }
  .zoom-in { --tw-enter-scale: 0.95; }
  .slide-in-from-bottom-4 { --tw-enter-translate-y: 1rem; }
  .slide-in-from-bottom-20 { --tw-enter-translate-y: 5rem; }
  .duration-300 { animation-duration: 0.3s; }
  .duration-500 { animation-duration: 0.5s; }
  @keyframes enter { from { opacity: var(--tw-enter-opacity, 1); transform: translate(var(--tw-enter-translate-x, 0), var(--tw-enter-translate-y, 0)) scale(var(--tw-enter-scale, 1)); } }`;

    const html = `<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>React App (Built)</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"><\/script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"><\/script>
  ${tailwindScript}
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body, #root { height: 100%; }
    ${animateStyles}
  </style>
</head>
<body>
  <div id="root"></div>
  <script>
${lucideShim}
// Transpiled React Application
${transpiledCode}
  <\/script>
</body>
</html>`;

    downloadFile(html, 'react-app-built.html', 'text/html');
    showToast('‚úÖ „Éì„É´„ÉâÊ∏à„ÅøHTML„Çí„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Åó„Åæ„Åó„ÅüÔºàBabel‰∏çË¶ÅÔºâ', 'success');
    console.log('[Build] „Éà„É©„É≥„Çπ„Éë„Ç§„É´ÂÆå‰∫Ü: Babel‰∏çË¶Å„ÅÆÊú¨Áï™Áî®HTML„ÇíÁîüÊàê„Åó„Åæ„Åó„Åü');
    
  } catch (err) {
    showToast('‚ùå „Éì„É´„Éâ„Ç®„É©„Éº: ' + err.message, 'error');
    console.error('[Build Error]', err.message);
  }
}

function generateJSXHTML(code) {
  const processed = preprocessJSX(code);
  const componentName = detectComponentName(processed);
  
  // Check if code uses lucide-react
  const usesLucide = code.includes('lucide-react') || code.includes('from "lucide-react"');
  const lucideScript = usesLucide ? `<script>
// LucideReact Shim with Proxy fallback
(function() {
  const icons = {Plus:'M12 5v14M5 12h14',X:'M18 6L6 18M6 6l12 12',Check:'M20 6L9 17l-5-5',ChevronLeft:'M15 18l-6-6 6-6',ChevronRight:'M9 18l6-6-6-6',ChevronUp:'M18 15l-6-6-6 6',ChevronDown:'M6 9l6 6 6-6',ChevronsLeft:'M11 17l-5-5 5-5m7 10l-5-5 5-5',ChevronsRight:'M13 17l5-5-5-5M6 17l5-5-5-5',Menu:'M4 6h16M4 12h16M4 18h16',Search:'M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z',LayoutGrid:'M3 3h7v7H3V3zm11 0h7v7h-7V3zm0 11h7v7h-7v-7zM3 14h7v7H3v-7z',Sidebar:'M19 3H5a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2V5a2 2 0 00-2-2zM9 3v18',Monitor:'M20 3H4a2 2 0 00-2 2v10a2 2 0 002 2h16a2 2 0 002-2V5a2 2 0 00-2-2zM8 21h8m-4-4v4',Maximize2:'M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7',Settings2:'M4 21v-7m0-4V3m8 18v-9m0-4V3m8 18v-5m0-4V3M1 14h6m2-6h6m2 8h6',Trash2:'M3 6h18m-2 0v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2m-6 5v6m4-6v6',Edit3:'M12 20h9M16.5 3.5a2.121 2.121 0 013 3L7 19l-4 1 1-4L16.5 3.5z',Save:'M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2zM17 21v-8H7v8M7 3v5h8',Download:'M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4m4-5l5 5 5-5m-5 5V3',Upload:'M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4m14-7l-5-5-5 5m5-5v12',FileUp:'M14.5 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V7.5L14.5 2zM14 2v6h6M12 12v6m-3-3l3-3 3 3',FileCode:'M14.5 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V7.5L14.5 2zM14 2v6h6m-8 5l-2 2 2 2m4-4l2 2-2 2',FileText:'M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8l-6-6zM14 2v6h6m-4 5H8m8 4H8m2-8H8',FileSearch:'M4 22h14a2 2 0 002-2V7.5L14.5 2H6a2 2 0 00-2 2v3m14 0V2l6 6h-6M4 14a3 3 0 100 6 3 3 0 000-6zm-2.5 7.5L4 19',ExternalLink:'M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6m4-3h6v6m-11 5L21 3',Globe:'M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10zM2 12h20M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z',PlusCircle:'M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10zM12 8v8m-4-4h8',Archive:'M21 8v13H3V8M1 3h22v5H1V3zm9 9h4',RefreshCw:'M23 4v6h-6M1 20v-6h6M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15',Sparkles:'M12 3l1.912 5.813a2 2 0 001.275 1.275L21 12l-5.813 1.912a2 2 0 00-1.275 1.275L12 21l-1.912-5.813a2 2 0 00-1.275-1.275L3 12l5.813-1.912a2 2 0 001.275-1.275L12 3zM5 3v4M19 17v4M3 5h4m10 14h4',Volume2:'M11 5L6 9H2v6h4l5 4V5zm8.07-.07a10 10 0 010 14.14M15.54 8.46a5 5 0 010 7.07',Loader2:'M21 12a9 9 0 11-6.219-8.56',MessageSquare:'M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z',Code:'M16 18l6-6-6-6M8 6l-6 6 6 6',Send:'M22 2L11 13m11-11l-7 20-4-9-9-4 20-7z',Copy:'M20 9h-9a2 2 0 00-2 2v9a2 2 0 002 2h9a2 2 0 002-2v-9a2 2 0 00-2-2zM5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1',AlertCircle:'M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10zM12 8v4m0 4h.01',Info:'M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10zM12 16v-4m0-4h.01'};
  const base = {};
  for (const [n, d] of Object.entries(icons)) {
    base[n] = (p) => {
      const { size = 24, color = 'currentColor', strokeWidth = 2, className = '', style = {}, ...r } = p || {};
      return React.createElement('svg', { xmlns: 'http://www.w3.org/2000/svg', width: size, height: size, viewBox: '0 0 24 24', fill: 'none', stroke: color, strokeWidth, strokeLinecap: 'round', strokeLinejoin: 'round', className, style, ...r }, React.createElement('path', { d }));
    };
  }
  const fallback = (p) => {
    const { size = 24, color = 'currentColor', strokeWidth = 2, className = '', style = {}, ...r } = p || {};
    return React.createElement('svg', { xmlns: 'http://www.w3.org/2000/svg', width: size, height: size, viewBox: '0 0 24 24', fill: 'none', stroke: color, strokeWidth, strokeLinecap: 'round', strokeLinejoin: 'round', className, style, ...r }, React.createElement('circle', { cx: 12, cy: 12, r: 10 }));
  };
  window.LucideReact = new Proxy(base, { get: (t, p) => t[p] || (console.warn('[LucideReact] Missing: ' + p), fallback) });
})();
<\\/script>` : '';
  
  // Check if code uses Tailwind classes
  const usesTailwind = /className\s*=\s*["'][^"']*(?:bg-|text-|flex|grid|p-|m-|w-|h-|rounded|border|shadow|hover:|focus:)/.test(code);
  const tailwindScript = usesTailwind ? '<script src="https://cdn.tailwindcss.com"><\\/script>' : '';
  
  const animateStyles = `<style>
  .animate-in { animation: enter 0.3s ease-out; }
  .fade-in { --tw-enter-opacity: 0; }
  .zoom-in { --tw-enter-scale: 0.95; }
  .zoom-in-50 { --tw-enter-scale: 0.5; }
  .slide-in-from-bottom-20 { --tw-enter-translate-y: 5rem; }
  .slide-in-from-bottom-4 { --tw-enter-translate-y: 1rem; }
  .slide-in-from-bottom-2 { --tw-enter-translate-y: 0.5rem; }
  .slide-in-from-right-24 { --tw-enter-translate-x: 6rem; }
  .duration-300 { animation-duration: 0.3s; }
  .duration-500 { animation-duration: 0.5s; }
  .duration-700 { animation-duration: 0.7s; }
  @keyframes enter { from { opacity: var(--tw-enter-opacity, 1); transform: translate(var(--tw-enter-translate-x, 0), var(--tw-enter-translate-y, 0)) scale(var(--tw-enter-scale, 1)); } }
</style>`;
  
  return `<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>React App</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"><\/script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"><\/script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"><\/script>
  ${tailwindScript}
  ${lucideScript}
  ${animateStyles}
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body, #root { height: 100%; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
${code}

ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(${componentName}));
  <\/script>
</body>
</html>`;
}

function generateMarkdownHTML(code) {
  const html = marked.parse(code);
  return `<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"><\/script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 40px 20px;
      line-height: 1.8;
      color: #333;
    }
    h1, h2, h3 { margin-top: 1.5em; margin-bottom: 0.5em; }
    h1 { font-size: 2em; border-bottom: 1px solid #eee; padding-bottom: 0.3em; }
    h2 { font-size: 1.5em; }
    code { background: #f5f5f5; padding: 2px 6px; border-radius: 4px; font-size: 0.9em; }
    pre { background: #f5f5f5; padding: 16px; border-radius: 8px; overflow-x: auto; }
    pre code { background: none; padding: 0; }
    blockquote { border-left: 4px solid #ddd; padding-left: 16px; color: #666; margin: 1em 0; }
    a { color: #0066cc; }
    img { max-width: 100%; }
  </style>
</head>
<body>
${html}
<script>hljs.highlightAll();<\/script>
</body>
</html>`;
}

function generateSVGHTML(code) {
  return `<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SVG Image</title>
  <style>
    body {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      margin: 0;
      background: #f5f5f5;
    }
  </style>
</head>
<body>
${code}
</body>
</html>`;
}

function generateDataHTML(code, title, lang) {
  const escaped = code.replace(/</g, '&lt;').replace(/>/g, '&gt;');
  return `<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>${title} Data</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"><\/script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 20px;
      background: #1e1e1e;
      color: #d4d4d4;
    }
    pre {
      margin: 0;
      padding: 20px;
      border-radius: 8px;
      overflow-x: auto;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 14px;
      line-height: 1.6;
    }
  </style>
</head>
<body>
<pre><code class="language-${lang}">${escaped}</code></pre>
<script>hljs.highlightAll();<\/script>
</body>
</html>`;
}

function generateCodeHTML(code, title, lang) {
  const escaped = code.replace(/</g, '&lt;').replace(/>/g, '&gt;');
  return `<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>${title}</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"><\/script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 20px;
      background: #1e1e1e;
      color: #d4d4d4;
    }
    pre {
      margin: 0;
      padding: 20px;
      border-radius: 8px;
      overflow-x: auto;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 14px;
      line-height: 1.6;
    }
  </style>
</head>
<body>
<pre><code class="language-${lang}">${escaped}</code></pre>
<script>hljs.highlightAll();<\/script>
</body>
</html>`;
}

function downloadFile(content, filename, mimeType) {
  const blob = new Blob([content], { type: mimeType });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}

function showToast(message, type = '') {
  toast.textContent = message;
  toast.className = `toast ${type} show`;
  clearTimeout(toast._timer);
  toast._timer = setTimeout(() => toast.classList.remove('show'), 3000);
}

function formatSize(bytes) {
  if (bytes < 1024) return bytes + ' B';
  if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
  return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
}

function escapeHtml(text) {
  if (typeof text !== 'string') text = String(text);
  return text.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
}
</script>

</body>
</html>
